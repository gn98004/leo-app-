<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¿ƒé‡ XinYou - Demoï¼ˆç°¡åŒ–ç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", "Microsoft JhengHei", sans-serif;
      background: #f3f4f6;
      color: #111827;
      font-size: 16px;
    }
    .top-bar {
      position: sticky;
      top: 0;
      z-index: 10;
      height: 56px;
      padding: 0 16px;
      background: #ffffff;
      border-bottom: 0.5px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
    }
    main {
      padding-bottom: 70px;
    }
    .page {
      display: none;
      padding: 12px 12px 0;
    }
    .page.active {
      display: block;
    }
    .card {
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 2px 4px rgba(15, 23, 42, 0.08);
      padding: 12px 14px;
      margin-bottom: 12px;
    }
    .page-title {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    /* äººå€‘ */
    .people-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    .people-card {
      border-radius: 14px;
      overflow: hidden;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      cursor: pointer;
    }
    .people-photo {
      width: 100%;
      padding-top: 140%;
      position: relative;
      background: #e5e7eb;
    }
    .people-photo-inner {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
    }
    .people-info {
      padding: 6px 8px 8px;
    }
    .people-name-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-bottom: 2px;
    }
    .people-name {
      font-weight: 600;
    }
    .people-age {
      color: #6b7280;
    }
    .people-desc {
      font-size: 13px;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* å¥½å‹ */
    .friend-item {
      display: flex;
      align-items: center;
      padding: 10px 0;
      border-bottom: 0.5px solid #e5e7eb;
      cursor: pointer;
    }
    .friend-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      font-size: 20px;
    }
    .friend-main {
      flex: 1;
      min-width: 0;
    }
    .friend-name-row {
      display: flex;
      justify-content: space-between;
      font-size: 15px;
    }
    .friend-name {
      font-weight: 600;
    }
    .friend-last {
      font-size: 12px;
      color: #6b7280;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* æ’è¡Œæ¦œ */
    .rank-top-row {
      display: flex;
      justify-content: center;
      gap: 18px;
      margin-top: 4px;
      margin-bottom: 10px;
    }
    .rank-card {
      text-align: center;
    }
    .rank-avatar-big {
      width: 80px;
      height: 80px;
      border-radius: 999px;
      border: 3px solid gold;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 30px;
      margin: 0 auto 4px;
    }
    .rank-avatar-mid {
      width: 60px;
      height: 60px;
      border-radius: 999px;
      border: 2px solid silver;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin: 0 auto 4px;
    }
    .rank-name {
      font-size: 14px;
      font-weight: 600;
    }
    .rank-score {
      font-size: 12px;
      color: #6b7280;
    }
    .rank-list-item {
      display: flex;
      align-items: center;
      padding: 6px 0;
      border-bottom: 0.5px solid #e5e7eb;
      font-size: 14px;
    }
    .rank-pos {
      width: 22px;
      color: #6b7280;
    }
    .rank-list-name {
      flex: 1;
    }
    .rank-list-score {
      font-size: 12px;
      color: #4b5563;
    }
    /* æˆ‘çš„ */
    .my-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }
    .my-avatar {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .my-main {
      flex: 1;
      min-width: 0;
    }
    .my-name {
      font-size: 18px;
      font-weight: 700;
    }
    .my-sub {
      font-size: 13px;
      color: #6b7280;
    }
    .my-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      margin-top: 4px;
    }
    .vip-label {
      font-size: 13px;
      color: #4b5563;
    }
    .vip-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 12px;
      background: #fef3c7;
      color: #92400e;
    }
    .btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 6px 10px;
      font-size: 14px;
      background: #ffffff;
      cursor: pointer;
    }
    .btn-primary {
      background: #2563eb;
      border-color: #2563eb;
      color: #ffffff;
    }
    .btn-sm {
      padding: 3px 8px;
      font-size: 12px;
    }
    textarea {
      width: 100%;
      min-height: 72px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      padding: 8px;
      font-size: 14px;
      resize: vertical;
      outline: none;
    }
    textarea:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.15);
    }
    .field-label {
      font-size: 14px;
      color: #374151;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    .diary-tools {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 6px;
      gap: 8px;
      flex-wrap: wrap;
      font-size: 13px;
    }
    .diary-tools-left {
      display: flex;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .diary-preview-box {
      margin-top: 8px;
      display: none;
    }
    .diary-preview-box.show {
      display: block;
    }
    .diary-preview-box img {
      max-width: 100%;
      border-radius: 10px;
      display: block;
    }
    .diary-scale {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 4px;
      font-size: 12px;
      color: #6b7280;
    }
    .diary-scale input[type="range"] {
      flex: 1;
    }
    .diary-list {
      margin-top: 8px;
      border-top: 0.5px solid #e5e7eb;
      padding-top: 8px;
      max-height: 260px;
      overflow-y: auto;
    }
    .diary-empty {
      font-size: 13px;
      color: #9ca3af;
    }
    .diary-item {
      padding: 6px 0;
      border-bottom: 0.5px solid #f3f4f6;
      font-size: 14px;
    }
    .diary-item:last-child {
      border-bottom: none;
    }
    .diary-meta {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 3px;
    }
    .diary-text {
      white-space: pre-wrap;
      word-break: break-word;
    }
    .diary-img {
      margin-top: 4px;
      border-radius: 10px;
      max-width: 100%;
    }
    .diary-limit-note {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }
    /* èŠå¤©è¦–çª—ï¼ˆç°¡åŒ–ï¼‰ */
    .chat-panel {
      position: fixed;
      inset: 56px 0 70px 0;
      background: #ffffff;
      display: none;
      flex-direction: column;
      z-index: 20;
      box-shadow: 0 0 12px rgba(15,23,42,0.18);
    }
    .chat-panel.show {
      display: flex;
    }
    .chat-panel-header {
      height: 44px;
      border-bottom: 0.5px solid #e5e7eb;
      display: flex;
      align-items: center;
      padding: 0 10px;
      font-size: 15px;
      gap: 8px;
    }
    .chat-back {
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 20px;
    }
    .chat-panel-body {
      flex: 1;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px;
      background: #f3f4f6;
    }
    .bubble-row {
      display: flex;
      margin-bottom: 6px;
    }
    .bubble-row.me {
      justify-content: flex-end;
    }
    .bubble {
      max-width: 76%;
      padding: 8px 10px;
      border-radius: 16px;
      font-size: 14px;
      background: #ffffff;
      border: 1px solid #e5e7eb;
    }
    .bubble.me {
      background: #4ade80;
      border-color: #22c55e;
      color: #064e3b;
    }
    .chat-input-area {
      border-top: 0.5px solid #e5e7eb;
      padding: 6px 8px;
      background: #ffffff;
    }
    .chat-input-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    .chat-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 6px 10px;
      font-size: 14px;
      outline: none;
    }
    .chat-send-btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 14px;
      background: #2563eb;
      color: #ffffff;
      cursor: pointer;
    }
    /* åº•éƒ¨å°è¦½ */
    .bottom-nav {
      position: fixed;
      inset-inline: 0;
      bottom: 0;
      height: 60px;
      border-top: 0.5px solid #e5e7eb;
      background: #ffffff;
      display: flex;
      z-index: 30;
    }
    .nav-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #9ca3af;
      cursor: pointer;
      gap: 2px;
    }
    .nav-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1.5px solid #d1d5db;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      background: #f9fafb;
    }
    .nav-item.active {
      color: #2563eb;
    }
    .nav-item.active .nav-icon {
      border-color: #2563eb;
      background: #eff6ff;
      color: #2563eb;
    }
  </style>
</head>
<body>
  <header class="top-bar">
    å¿ƒé‡ XinYou - Demo
  </header>
  <main>
    <!-- äººå€‘ -->
    <section id="page-people" class="page active">
      <div class="card">
        <div class="page-title">äººå€‘ Â· å·§é‡</div>
        <div class="people-grid" id="peopleGrid"></div>
      </div>
    </section>

    <!-- å¥½å‹ -->
    <section id="page-friends" class="page">
      <div class="card">
        <div class="page-title">å¥½å‹ Â· å°è©±</div>
        <div id="friendList"></div>
      </div>
    </section>

    <!-- æ’è¡Œæ¦œ -->
    <section id="page-rank" class="page">
      <div class="card">
        <div class="page-title">æ’è¡Œæ¦œ Â· è´ˆç¦®ç‹</div>
        <div class="rank-top-row" id="rankTopRow"></div>
        <div class="rank-list" id="rankList"></div>
      </div>
    </section>

    <!-- æˆ‘çš„ -->
    <section id="page-my" class="page">
      <div class="card">
        <div class="my-header">
          <div class="my-avatar" id="myAvatar">æˆ‘</div>
          <div class="my-main">
            <div class="my-name" id="myName">å¿ƒé‡ä½¿ç”¨è€…</div>
            <div class="my-sub" id="mySub">å°ç£ Â· å¿ƒæƒ…ï¼šã€Œå¹³éœä¸­ã€</div>
            <div class="my-row">
              <span class="vip-label">æœƒå“¡ç‹€æ…‹ï¼š</span>
              <span class="vip-badge" id="vipBadge">å…è²»ä½¿ç”¨è€…</span>
            </div>
          </div>
        </div>
        <div class="my-row" style="margin-top: 6px;">
          <span>åˆ‡æ› VIP ç‹€æ…‹ï¼ˆæ¸¬è©¦ç”¨ï¼‰</span>
          <button class="btn btn-sm" id="vipToggleBtn">åˆ‡æ› VIP</button>
        </div>
        <div class="diary-limit-note" id="diaryLimitNote">
          å…è²»ä½¿ç”¨è€…å¯æ–°å¢ 5 ç¯‡æ—¥è¨˜ï¼›VIP ä½¿ç”¨è€…å¯æ–°å¢ 30 ç¯‡æ—¥è¨˜ã€‚
        </div>
      </div>

      <div class="card">
        <div class="page-title">æˆ‘çš„æ—¥è¨˜</div>
        <label class="field-label" for="diaryText">ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ</label>
        <textarea id="diaryText" placeholder="å¯«é»ä»€éº¼çµ¦æœªä¾†çš„è‡ªå·±çœ‹..."></textarea>
        <div class="field-label">æ—¥è¨˜ç…§ç‰‡ï¼ˆå¯é¸ï¼‰</div>
        <div class="diary-tools">
          <div class="diary-tools-left">
            <button class="btn btn-sm" id="diaryImageBtn">é¸æ“‡ç…§ç‰‡</button>
            <input type="file" id="diaryImageInput" accept="image/*" style="display: none;" />
          </div>
          <button class="btn btn-primary btn-sm" id="diaryAddBtn">æ–°å¢æ—¥è¨˜</button>
        </div>
        <div class="diary-preview-box" id="diaryPreviewBox">
          <img id="diaryPreviewImg" alt="é è¦½åœ–ç‰‡" />
          <div class="diary-scale">
            <span>ç¸®æ”¾ï¼š</span>
            <input type="range" id="diaryScaleRange" min="60" max="140" value="100" />
            <span id="diaryScaleLabel">100%</span>
          </div>
        </div>
        <div class="diary-list" id="diaryList"></div>
      </div>
    </section>
  </main>

  <!-- èŠå¤©è¦–çª— -->
  <div class="chat-panel" id="chatPanel">
    <div class="chat-panel-header">
      <button class="chat-back" id="chatBackBtn">â†</button>
      <div>
        <div id="chatTitle" style="font-weight:600;"></div>
        <div id="chatSub" style="font-size:11px;color:#9ca3af;"></div>
      </div>
    </div>
    <div class="chat-panel-body">
      <div class="chat-messages" id="chatMessages"></div>
      <div class="chat-input-area">
        <div class="chat-input-row">
          <input id="chatInput" class="chat-input" type="text" placeholder="å‚³å€‹è¨Šæ¯..." />
          <button class="chat-send-btn" id="chatSendBtn">é€å‡º</button>
        </div>
      </div>
    </div>
  </div>

  <!-- åº•éƒ¨å°è¦½ -->
  <nav class="bottom-nav">
    <div class="nav-item active" data-page="people">
      <div class="nav-icon">äºº</div>
      <div>äººå€‘</div>
    </div>
    <div class="nav-item" data-page="friends">
      <div class="nav-icon">å‹</div>
      <div>å¥½å‹</div>
    </div>
    <div class="nav-item" data-page="rank">
      <div class="nav-icon">æ¦œ</div>
      <div>æ’è¡Œ</div>
    </div>
    <div class="nav-item" data-page="my">
      <div class="nav-icon">æˆ‘</div>
      <div>æˆ‘çš„</div>
    </div>
  </nav>

  <script>
    /* å‡è³‡æ–™ï¼šäººå€‘ */
    const PEOPLE = [
      { id: 1, name: "å°å¤", age: 29, desc: "å–œæ­¡æµ·é‚Šã€éœ²ç‡Ÿå’Œå–å’–å•¡", emoji: "ğŸ–ï¸" },
      { id: 2, name: "é˜¿å‡œ", age: 32, desc: "ä¸‹ç­åœ¨å®¶çœ‹åŠ‡çš„ç¤¾æå·¥ç¨‹å¸«", emoji: "ğŸ’»" },
      { id: 3, name: "Mia", age: 26, desc: "åŸå¸‚è£¡æ‰¾æ£®æ—æ„Ÿçš„æ”å½±å¸«", emoji: "ğŸ“¸" },
      { id: 4, name: "Leo", age: 30, desc: "æ­£åœ¨å­¸åšèœçš„æ‰‹æ®˜ä¸»å»š", emoji: "ğŸ³" }
    ];

    const FRIENDS = [
      { id: 101, name: "Nana", emoji: "ğŸ±", last: "æ˜¨å¤©é‚£éƒ¨é›»å½±çœŸçš„å¥½å¥½ç¬‘", mood: "ç·šä¸Š" },
      { id: 102, name: "é˜¿å“²", emoji: "ğŸ§", last: "ä¹‹å¾Œæœ‰ç©ºä¸€èµ·å»ç¦å²¡èµ°èµ°", mood: "å¿™ç¢Œä¸­" },
      { id: 103, name: "æ—å°è·¯", emoji: "ğŸ’", last: "æˆ‘å‰›åˆ°å°åŒ—è»Šç«™ï½", mood: "å‰›å‰›ä¸Šç·š" }
    ];

    const RANK = [
      { id: 201, name: "ç¦®ç‰©ä¹‹ç‹", emoji: "ğŸ‘‘", score: 9520 },
      { id: 202, name: "å¤œè²“é€èŠ±æ‰‹", emoji: "ğŸŒ™", score: 7880 },
      { id: 203, name: "èª å¯¦å°å¤ªé™½", emoji: "â˜€ï¸", score: 7310 },
      { id: 204, name: "å†’éšªå®¶77", emoji: "ğŸ§­", score: 6120 },
      { id: 205, name: "æ³¡æ¾¡é…æ­Œæ‰‹", emoji: "ğŸ›", score: 5980 }
    ];

    /* â€”â€” åº•éƒ¨å°è¦½ â€”â€” */
    const pages = {
      people: document.getElementById("page-people"),
      friends: document.getElementById("page-friends"),
      rank: document.getElementById("page-rank"),
      my: document.getElementById("page-my")
    };
    const navItems = document.querySelectorAll(".bottom-nav .nav-item");
    navItems.forEach(item => {
      item.addEventListener("click", () => {
        const page = item.getAttribute("data-page");
        Object.values(pages).forEach(p => p.classList.remove("active"));
        pages[page].classList.add("active");
        navItems.forEach(n => n.classList.remove("active"));
        item.classList.add("active");
      });
    });

    /* â€”â€” äººå€‘ â€”â€” */
    function renderPeople() {
      const grid = document.getElementById("peopleGrid");
      grid.innerHTML = "";
      PEOPLE.forEach(p => {
        const card = document.createElement("div");
        card.className = "people-card";
        card.innerHTML = \`
          <div class="people-photo"><div class="people-photo-inner">\${p.emoji}</div></div>
          <div class="people-info">
            <div class="people-name-row">
              <span class="people-name">\${p.name}</span>
              <span class="people-age">\${p.age} æ­²</span>
            </div>
            <div class="people-desc">\${p.desc}</div>
          </div>
        \`;
        grid.appendChild(card);
      });
    }

    /* â€”â€” å¥½å‹ & èŠå¤© â€”â€” */
    let currentChatFriend = null;
    const chatPanel = document.getElementById("chatPanel");
    const chatTitleEl = document.getElementById("chatTitle");
    const chatSubEl = document.getElementById("chatSub");
    const chatMessagesEl = document.getElementById("chatMessages");
    const chatInputEl = document.getElementById("chatInput");
    const chatSendBtn = document.getElementById("chatSendBtn");
    const chatBackBtn = document.getElementById("chatBackBtn");

    function renderFriends() {
      const container = document.getElementById("friendList");
      container.innerHTML = "";
      FRIENDS.forEach(f => {
        const row = document.createElement("div");
        row.className = "friend-item";
        row.innerHTML = \`
          <div class="friend-avatar">\${f.emoji}</div>
          <div class="friend-main">
            <div class="friend-name-row">
              <span class="friend-name">\${f.name}</span>
              <span style="font-size:12px;color:#9ca3af;">\${f.mood}</span>
            </div>
            <div class="friend-last">\${f.last}</div>
          </div>
        \`;
        row.addEventListener("click", () => openChat(f));
        container.appendChild(row);
      });
    }

    function openChat(friend) {
      currentChatFriend = friend;
      chatTitleEl.textContent = friend.name;
      chatSubEl.textContent = "ç¤ºæ„èŠå¤©å®¤ Â· å°šæœªé€£æ¥çœŸæ­£ä¼ºæœå™¨";
      chatMessagesEl.innerHTML = "";
      appendChatBubble(friend.name, friend.last, false);
      chatPanel.classList.add("show");
    }
    function closeChat() {
      chatPanel.classList.remove("show");
      currentChatFriend = null;
    }
    function appendChatBubble(fromName, text, isMe) {
      const row = document.createElement("div");
      row.className = "bubble-row" + (isMe ? " me" : "");
      const bubble = document.createElement("div");
      bubble.className = "bubble" + (isMe ? " me" : "");
      bubble.textContent = text;
      row.appendChild(bubble);
      chatMessagesEl.appendChild(row);
      chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
    }

    chatBackBtn.addEventListener("click", closeChat);
    chatSendBtn.addEventListener("click", () => {
      const text = chatInputEl.value.trim();
      if (!text || !currentChatFriend) return;
      appendChatBubble("æˆ‘", text, true);
      chatInputEl.value = "";
    });
    chatInputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        chatSendBtn.click();
      }
    });

    /* â€”â€” æ’è¡Œæ¦œ â€”â€” */
    function renderRank() {
      const topRow = document.getElementById("rankTopRow");
      const listEl = document.getElementById("rankList");
      topRow.innerHTML = "";
      listEl.innerHTML = "";

      // å‰ä¸‰å
      const [first, second, third, ...rest] = RANK;
      const top = [second, first, third]; // 2,1,3 æ’åˆ—æˆé‡‘å­—å¡”æ„Ÿè¦º
      top.forEach((p, idx) => {
        const div = document.createElement("div");
        div.className = "rank-card";
        const isKing = p.id === first.id;
        const avatarClass = isKing ? "rank-avatar-big" : "rank-avatar-mid";
        div.innerHTML = \`
          <div class="\${avatarClass}">\${p.emoji}</div>
          <div class="rank-name">\${p.name}</div>
          <div class="rank-score">\${p.score} åˆ†</div>
        \`;
        topRow.appendChild(div);
      });

      // å¾Œé¢æ’å
      RANK.forEach((p, idx) => {
        const row = document.createElement("div");
        row.className = "rank-list-item";
        row.innerHTML = \`
          <div class="rank-pos">\${idx + 1}</div>
          <div class="rank-list-name">\${p.name}</div>
          <div class="rank-list-score">\${p.score} åˆ†</div>
        \`;
        listEl.appendChild(row);
      });
    }

    /* â€”â€” VIP & æ—¥è¨˜ â€”â€” */
    const VIP_KEY = "hmVipLevel";
    const DIARY_KEY = "hmMyDiaries";

    function getVipLevel() {
      const raw = localStorage.getItem(VIP_KEY);
      const n = parseInt(raw, 10);
      if (Number.isNaN(n)) return 0;
      return n > 0 ? 1 : 0; // ç›®å‰åªåˆ† å…è²» / VIP
    }
    function setVipLevel(level) {
      const v = level ? 1 : 0;
      localStorage.setItem(VIP_KEY, String(v));
    }
    function getDiaryLimit() {
      const v = getVipLevel();
      return v === 1 ? 30 : 5;
    }

    function loadDiaries() {
      const raw = localStorage.getItem(DIARY_KEY);
      if (!raw) return [];
      try {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed)) return parsed;
      } catch {}
      return [];
    }
    function saveDiaries(list) {
      localStorage.setItem(DIARY_KEY, JSON.stringify(list));
    }

    const vipBadgeEl = document.getElementById("vipBadge");
    const vipToggleBtn = document.getElementById("vipToggleBtn");
    const diaryLimitNoteEl = document.getElementById("diaryLimitNote");
    const diaryTextEl = document.getElementById("diaryText");
    const diaryImageBtn = document.getElementById("diaryImageBtn");
    const diaryImageInput = document.getElementById("diaryImageInput");
    const diaryAddBtn = document.getElementById("diaryAddBtn");
    const diaryPreviewBox = document.getElementById("diaryPreviewBox");
    const diaryPreviewImg = document.getElementById("diaryPreviewImg");
    const diaryScaleRange = document.getElementById("diaryScaleRange");
    const diaryScaleLabel = document.getElementById("diaryScaleLabel");
    const diaryListEl = document.getElementById("diaryList");

    let tempDiaryImgData = null;

    function refreshVipUi() {
      const v = getVipLevel();
      if (v === 1) {
        vipBadgeEl.textContent = "VIP ä½¿ç”¨è€…";
      } else {
        vipBadgeEl.textContent = "å…è²»ä½¿ç”¨è€…";
      }
      diaryLimitNoteEl.textContent =
        "å…è²»ä½¿ç”¨è€…å¯æ–°å¢ 5 ç¯‡æ—¥è¨˜ï¼›VIP ä½¿ç”¨è€…å¯æ–°å¢ 30 ç¯‡æ—¥è¨˜ã€‚ç•¶å‰ä¸Šé™ï¼š" +
        getDiaryLimit() +
        " ç¯‡ã€‚";
    }

    vipToggleBtn.addEventListener("click", () => {
      const v = getVipLevel();
      const next = v === 1 ? 0 : 1;
      setVipLevel(next);
      refreshVipUi();
      renderDiaryList();
    });

    diaryImageBtn.addEventListener("click", () => {
      diaryImageInput.click();
    });
    diaryImageInput.addEventListener("change", (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        tempDiaryImgData = ev.target.result;
        diaryPreviewImg.src = tempDiaryImgData;
        diaryPreviewBox.classList.add("show");
      };
      reader.readAsDataURL(file);
    });

    diaryScaleRange.addEventListener("input", () => {
      const val = parseInt(diaryScaleRange.value, 10);
      diaryScaleLabel.textContent = val + "%";
    });

    diaryAddBtn.addEventListener("click", () => {
      const text = diaryTextEl.value.trim();
      const img = tempDiaryImgData;
      if (!text && !img) {
        alert("è«‹è‡³å°‘è¼¸å…¥æ–‡å­—æˆ–é¸æ“‡ä¸€å¼µç…§ç‰‡å†æ–°å¢æ—¥è¨˜ã€‚");
        return;
      }
      const list = loadDiaries();
      const limit = getDiaryLimit();
      if (list.length >= limit) {
        if (getVipLevel() === 0) {
          alert("å…è²»ä½¿ç”¨è€…æœ€å¤šåªèƒ½æ–°å¢ 5 ç¯‡æ—¥è¨˜ã€‚
è‹¥æƒ³å¯«åˆ° 30 ç¯‡ï¼Œè«‹å‡ç´šæˆ VIPï¼ˆç¤ºæ„åŠŸèƒ½ï¼‰ã€‚");
        } else {
          alert("å·²é”ç›®å‰è¨­å®šçš„æ—¥è¨˜ä¸Šé™ï¼š" + limit + " ç¯‡ã€‚");
        }
        return;
      }
      const scale = parseInt(diaryScaleRange.value, 10) || 100;
      const now = new Date();
      const item = {
        id: Date.now() + "_" + Math.random().toString(16).slice(2),
        text,
        img,
        scale,
        createdAt: now.toISOString()
      };
      list.push(item);
      saveDiaries(list);
      diaryTextEl.value = "";
      tempDiaryImgData = null;
      diaryImageInput.value = "";
      diaryPreviewBox.classList.remove("show");
      diaryScaleRange.value = 100;
      diaryScaleLabel.textContent = "100%";
      renderDiaryList();
    });

    function renderDiaryList() {
      const list = loadDiaries();
      diaryListEl.innerHTML = "";
      if (!list.length) {
        const div = document.createElement("div");
        div.className = "diary-empty";
        div.textContent = "ç›®å‰é‚„æ²’æœ‰æ—¥è¨˜ï¼Œå¯«ä¸€ç¯‡çµ¦æœªä¾†çš„è‡ªå·±å§ã€‚";
        diaryListEl.appendChild(div);
        return;
      }
      // ä¾æ™‚é–“ç”±æ–°åˆ°èˆŠ
      const sorted = list.slice().sort((a, b) => {
        return (b.createdAt || "").localeCompare(a.createdAt || "");
      });
      sorted.forEach((d) => {
        const wrap = document.createElement("div");
        wrap.className = "diary-item";
        const dateText = d.createdAt
          ? new Date(d.createdAt).toLocaleString("zh-TW", { hour12: false })
          : "";
        wrap.innerHTML = \`
          <div class="diary-meta">\${dateText}</div>
          <div class="diary-text"></div>
        \`;
        const textEl = wrap.querySelector(".diary-text");
        textEl.textContent = d.text || "";
        if (d.img) {
          const img = document.createElement("img");
          img.className = "diary-img";
          img.src = d.img;
          const scale = d.scale || 100;
          img.style.transform = "scale(" + scale / 100 + ")";
          wrap.appendChild(img);
        }
        diaryListEl.appendChild(wrap);
      });
    }

    /* â€”â€” åˆå§‹åŒ– â€”â€” */
    function initMyHeader() {
      const myNameEl = document.getElementById("myName");
      const mySubEl = document.getElementById("mySub");
      const name = "å¿ƒé‡æ¸¬è©¦å¸³è™Ÿ";
      myNameEl.textContent = name;
      mySubEl.textContent = "å°ç£ Â· 30 æ­²é™„è¿‘ Â· å¿ƒæƒ…ï¼šã€Œå¹³éœä¸­ã€";
      const avatar = document.getElementById("myAvatar");
      avatar.textContent = name.slice(0, 1);
    }

    function init() {
      renderPeople();
      renderFriends();
      renderRank();
      initMyHeader();
      refreshVipUi();
      renderDiaryList();
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
