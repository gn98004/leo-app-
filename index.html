<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>å¿ƒé‡ XinYou - å‰å°æ•´åˆç‰ˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", "Microsoft JhengHei", sans-serif;
      background: #f3f4f6;
      color: #111827;
      font-size: 16px;
    }
    img {
      max-width: 100%;
      display: block;
    }
    button {
      font-family: inherit;
    }

    /* é ‚éƒ¨åˆ— */
    .top-bar {
      position: sticky;
      top: 0;
      z-index: 20;
      height: 56px;
      padding: 0 16px;
      background: #ffffff;
      border-bottom: 0.5px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .top-bar-inner {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 540px;
      margin: 0 auto;
    }
    .top-bar-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    /* ä¸»å…§å®¹å®¹å™¨ */
    .app-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .app-main {
      flex: 1;
      max-width: 540px;
      width: 100%;
      margin: 0 auto;
      padding: 12px 12px 72px;
    }

    /* åº•éƒ¨å°è¦½åˆ— */
    .tab-bar {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 60px;
      background: #ffffff;
      border-top: 0.5px solid #e5e7eb;
      display: flex;
      justify-content: center;
      z-index: 30;
    }
    .tab-bar-inner {
      width: 100%;
      max-width: 540px;
      display: flex;
    }
    .tab-item {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: #6b7280;
      cursor: pointer;
      user-select: none;
    }
    .tab-item span {
      margin-top: 2px;
    }
    .tab-item.active {
      color: #ec4899;
      font-weight: 600;
    }

    /* å€å¡Šé€šç”¨å¡ç‰‡ */
    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 12px 14px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
      margin-bottom: 12px;
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    .card-title {
      font-size: 15px;
      font-weight: 600;
    }
    .card-subtitle {
      font-size: 12px;
      color: #9ca3af;
    }

    /* å·§é‡é  (ç°¡åŒ–ç‰ˆç¤ºæ„) */
    .match-list {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    .match-item {
      background: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.06);
      position: relative;
    }
    .match-avatar {
      width: 100%;
      aspect-ratio: 3 / 4;
      object-fit: cover;
    }
    .match-info {
      padding: 6px 8px 8px;
      font-size: 13px;
    }
    .match-name {
      font-weight: 600;
      margin-bottom: 2px;
    }
    .match-meta {
      font-size: 12px;
      color: #6b7280;
    }

    /* æ’è¡Œæ¦œé  (ä½”ä½) */
    .rank-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .rank-item {
      display: flex;
      align-items: center;
      padding: 8px 10px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(15, 23, 42, 0.06);
    }
    .rank-no {
      width: 26px;
      font-weight: 700;
      color: #f97316;
    }
    .rank-body {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .rank-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      object-fit: cover;
    }
    .rank-name {
      font-size: 14px;
      font-weight: 600;
    }
    .rank-score {
      font-size: 12px;
      color: #6b7280;
    }

    /* æˆ‘çš„è³‡æ–™é  */
    .profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }
    .profile-avatar-wrapper {
      position: relative;
      width: 70px;
      height: 70px;
      border-radius: 999px;
      overflow: hidden;
      border: 2px solid #f9a8d4;
      flex-shrink: 0;
      cursor: pointer;
    }
    .profile-avatar {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .profile-avatar-label {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 10px;
      background: linear-gradient(to top, rgba(0,0,0,0.55), transparent);
      color: #fff;
      padding: 4px 2px 2px;
    }
    .profile-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .profile-name {
      font-size: 16px;
      font-weight: 600;
    }
    .profile-line {
      font-size: 12px;
      color: #4b5563;
    }
    .profile-tag {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #fee2e2;
      color: #b91c1c;
      margin-right: 4px;
    }
    .profile-tag.vip {
      background: #fef3c7;
      color: #b45309;
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.15s ease;
      user-select: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, #ec4899, #f97316);
      color: #fff;
      box-shadow: 0 4px 10px rgba(236, 72, 153, 0.4);
    }
    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 2px 6px rgba(236, 72, 153, 0.4);
    }
    .btn-outline {
      background: #fff;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }
    .btn-sm {
      padding: 4px 10px;
      font-size: 12px;
    }
    .btn-block {
      width: 100%;
      justify-content: center;
    }

    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 4px 0 6px;
    }
    .section-desc {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 8px;
    }

    .field-group {
      margin-bottom: 8px;
    }
    .field-label {
      font-size: 12px;
      color: #6b7280;
      margin-bottom: 4px;
    }
    .field-input,
    .field-select,
    .field-textarea {
      width: 100%;
      border-radius: 8px;
      border: 1px solid #e5e7eb;
      padding: 7px 9px;
      font-size: 14px;
      font-family: inherit;
      outline: none;
      background: #f9fafb;
    }
    .field-input:focus,
    .field-select:focus,
    .field-textarea:focus {
      border-color: #ec4899;
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(236, 72, 153, 0.15);
    }
    .field-textarea {
      resize: vertical;
      min-height: 60px;
    }
    .field-note {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      background: #e5e7eb;
      color: #4b5563;
    }

    /* æ—¥è¨˜å€ */
    .diary-layout {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .diary-editor {
      border-radius: 10px;
      background: #f9fafb;
      padding: 8px 10px;
      border: 1px dashed #e5e7eb;
    }
    .diary-limit {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .diary-limit span {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .diary-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .diary-item {
      border-radius: 10px;
      background: #f9fafb;
      padding: 8px 10px;
      border: 1px solid #e5e7eb;
      font-size: 13px;
    }
    .diary-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
      gap: 6px;
      flex-wrap: wrap;
    }
    .diary-text {
      white-space: pre-wrap;
      word-break: break-word;
      margin-bottom: 4px;
    }
    .diary-image-wrap {
      margin-top: 4px;
      border-radius: 8px;
      overflow: hidden;
      background: #000;
    }
    .diary-image-wrap img {
      display: block;
      margin: 0 auto;
    }
    .diary-image-note {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }
    .diary-empty {
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
      padding: 6px 0;
    }

    /* ä¸Šå‚³åœ–ç‰‡å€ */
    .diary-tools {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 6px 0 4px;
    }
    .chip-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 4px 8px;
      font-size: 11px;
      background: #fff;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }
    .chip-btn:active {
      background: #f3f4f6;
    }

    .range-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }
    .range-row input[type="range"] {
      flex: 1;
    }
    .range-label {
      font-size: 11px;
      color: #6b7280;
      white-space: nowrap;
    }

    .diary-preview {
      margin-top: 6px;
      display: none;
    }
    .diary-preview img {
      border-radius: 8px;
      max-height: 160px;
      object-fit: contain;
      margin: 0 auto;
    }

    .text-danger {
      color: #b91c1c;
    }

    .vip-toggle-row {
      margin-top: 6px;
      font-size: 11px;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }
    .vip-toggle-row select {
      font-size: 11px;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fff;
    }

    /* é¡¯ç¤º / éš±è—é é¢ */
    .page {
      display: none;
    }
    .page.active {
      display: block;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header class="top-bar">
    <div class="top-bar-inner">
      <div style="width: 24px;"></div>
      <div class="top-bar-title">å¿ƒé‡ Â· XinYou</div>
      <div style="font-size: 11px; color:#9ca3af;">Demo</div>
    </div>
  </header>

  <main class="app-main">
    <!-- å·§é‡ -->
    <section id="page-match" class="page active">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">å·§é‡</div>
            <div class="card-subtitle">æ ¹æ“šåœ°å€èˆ‡åå¥½ï¼Œæ¨è–¦é™„è¿‘çš„éˆé­‚</div>
          </div>
        </div>
        <div class="match-list" id="matchList">
          <!-- ç¯„ä¾‹è³‡æ–™ -->
        </div>
      </div>
    </section>

    <!-- æ’è¡Œæ¦œ -->
    <section id="page-rank" class="page">
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">æœ¬é€±é­…åŠ›æ¦œ</div>
            <div class="card-subtitle">ä¾ç¦®ç‰©èˆ‡äº’å‹•ç†±åº¦æ’åº</div>
          </div>
        </div>
        <div class="rank-list" id="rankList">
          <!-- ç¯„ä¾‹è³‡æ–™ -->
        </div>
      </div>
    </section>

    <!-- æˆ‘çš„ -->
    <section id="page-me" class="page">
      <div class="card">
        <div class="card-header">
          <div class="card-title">æˆ‘çš„è³‡æ–™</div>
          <button class="btn btn-outline btn-sm" id="btnResetProfile">åˆªé™¤å¸³è™Ÿè³‡æ–™</button>
        </div>

        <!-- é ­åƒèˆ‡åŸºæœ¬å°å¤–è³‡è¨Š -->
        <div class="profile-header">
          <div class="profile-avatar-wrapper" id="avatarWrapper">
            <img id="avatarImg" class="profile-avatar"
                 src="https://images.pexels.com/photos/415829/pexels-photo-415829.jpeg?auto=compress&cs=tinysrgb&w=600"
                 alt="é ­åƒ" />
            <div class="profile-avatar-label">é»æ“Šæ›´æ›é ­è²¼</div>
            <input type="file" id="avatarFileInput" accept="image/*" style="display:none" />
          </div>
          <div class="profile-main">
            <div class="profile-name" id="profileDisplayName">æš±ç¨±æœªè¨­å®š</div>
            <div class="profile-line" id="profileDisplayMeta1">å°ç£ãƒ»å±…ä½åœ°æœªè¨­å®š</div>
            <div class="profile-line" id="profileDisplayMeta2">èº«é«˜ / é«”é‡æœªè¨­å®š</div>
            <div>
              <span class="profile-tag" id="profileStatusTag">ä¸€èˆ¬ç”¨æˆ¶</span>
              <span class="profile-tag vip" id="profileVipTag" style="display:none;">VIP</span>
            </div>
          </div>
        </div>

        <!-- ç·¨è¼¯åŸºæœ¬è³‡æ–™ -->
        <div class="section-title">åŸºæœ¬è³‡æ–™</div>
        <div class="section-desc">
          æ­¤å€ç‚ºé¦–æ¬¡è¨­å®šå¾Œå³é–å®šï¼Œåªèƒ½é€éã€Œåˆªé™¤å¸³è™Ÿè³‡æ–™ã€é‡æ–°å»ºç«‹ã€‚

        </div>
        <div id="baseProfileForm">
          <div class="field-group">
            <div class="field-label">æš±ç¨±</div>
            <input id="baseName" class="field-input" placeholder="è«‹è¼¸å…¥é¡¯ç¤ºæš±ç¨±" />
          </div>
          <div class="field-group">
            <div class="field-label">å±…ä½åŸå¸‚ï¼ˆå°ç£ï¼‰</div>
            <select id="baseCity" class="field-select">
              <option value="">è«‹é¸æ“‡åŸå¸‚</option>
              <option>å°åŒ—å¸‚</option>
              <option>æ–°åŒ—å¸‚</option>
              <option>æ¡ƒåœ’å¸‚</option>
              <option>å°ä¸­å¸‚</option>
              <option>å°å—å¸‚</option>
              <option>é«˜é›„å¸‚</option>
              <option>åŸºéš†å¸‚</option>
              <option>æ–°ç«¹å¸‚</option>
              <option>å˜‰ç¾©å¸‚</option>
              <option>æ–°ç«¹ç¸£</option>
              <option>è‹—æ —ç¸£</option>
              <option>å½°åŒ–ç¸£</option>
              <option>å—æŠ•ç¸£</option>
              <option>é›²æ—ç¸£</option>
              <option>å˜‰ç¾©ç¸£</option>
              <option>å±æ±ç¸£</option>
              <option>å®œè˜­ç¸£</option>
              <option>èŠ±è“®ç¸£</option>
              <option>å°æ±ç¸£</option>
              <option>æ¾æ¹–ç¸£</option>
              <option>é‡‘é–€ç¸£</option>
              <option>é€£æ±Ÿç¸£</option>
              <option>å…¶ä»–</option>
            </select>
          </div>
          <div class="field-group">
            <div class="field-label">èº«é«˜ï¼ˆcmï¼‰</div>
            <input id="baseHeight" type="number" class="field-input" placeholder="ä¾‹å¦‚ 172" />
          </div>
          <div class="field-group">
            <div class="field-label">é«”é‡ï¼ˆkgï¼‰</div>
            <input id="baseWeight" type="number" class="field-input" placeholder="ä¾‹å¦‚ 65" />
          </div>
          <div class="field-group">
            <button id="btnSaveBaseProfile" class="btn btn-primary btn-block">å„²å­˜åŸºæœ¬è³‡æ–™ä¸¦é–å®š</button>
            <div class="field-note">
              å„²å­˜å¾Œä¸Šè¿°æ¬„ä½å°‡é–å®šç„¡æ³•ä¿®æ”¹ï¼Œåƒ…èƒ½é€éã€Œåˆªé™¤å¸³è™Ÿè³‡æ–™ã€å…¨éƒ¨é‡è¨­ã€‚
            </div>
          </div>
        </div>

        <div id="baseProfileLockedMsg" style="display:none;">
          <div class="badge" style="margin-bottom:6px;">
            åŸºæœ¬è³‡æ–™å·²é–å®š
          </div>
          <div class="field-note">
            è‹¥éœ€ä¿®æ”¹æš±ç¨± / èº«é«˜ / é«”é‡ / åŸå¸‚ï¼Œè«‹ä½¿ç”¨ä¸Šæ–¹ã€Œåˆªé™¤å¸³è™Ÿè³‡æ–™ã€é‡å»ºå¸³è™Ÿã€‚
          </div>
        </div>

        <!-- ç¤¾ç¾¤å¸³è™Ÿ -->
        <div class="section-title" style="margin-top:10px;">ç¤¾ç¾¤å¸³è™Ÿï¼ˆå¯éš¨æ™‚ä¿®æ”¹ï¼‰</div>
        <div class="field-group">
          <div class="field-label">Instagram / Threads</div>
          <input id="socialIg" class="field-input" placeholder="@your_ig" />
        </div>
        <div class="field-group">
          <div class="field-label">LINE ID</div>
          <input id="socialLine" class="field-input" placeholder="è«‹è¼¸å…¥ LINE ID" />
        </div>
        <div class="field-group">
          <div class="field-label">å…¶ä»–è¯çµ¡æ–¹å¼</div>
          <input id="socialOther" class="field-input" placeholder="å¦‚ Telegram, WeChat..." />
        </div>
        <div class="field-group">
          <button id="btnSaveSocial" class="btn btn-outline btn-block">å„²å­˜ç¤¾ç¾¤è³‡è¨Š</button>
        </div>

        <div class="vip-toggle-row">
          <span>ç›®å‰èº«åˆ†ï¼š<span id="vipStatusText">ä¸€èˆ¬ç”¨æˆ¶ï¼ˆå…è²»ä¸Šé™ 5 å‰‡æ—¥è¨˜ï¼‰</span></span>
          <span>
            æ¸¬è©¦ç”¨ VIP åˆ‡æ›ï¼š
            <select id="vipLevelSelect">
              <option value="0">ä¸€èˆ¬ç”¨æˆ¶</option>
              <option value="1">VIP 1</option>
              <option value="2">VIP 2</option>
            </select>
          </span>
        </div>
      </div>

      <!-- æ—¥è¨˜å¡ç‰‡ -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">æˆ‘çš„æ—¥è¨˜</div>
            <div class="card-subtitle">è¨˜éŒ„æ¯å¤©çš„å°å¿ƒæƒ…ï¼Œå¯é™„ä¸€å¼µç…§ç‰‡</div>
          </div>
        </div>

        <div class="diary-layout">
          <!-- ç·¨è¼¯å€ -->
          <div class="diary-editor">
            <div class="field-group">
              <div class="field-label">æ—¥è¨˜å…§å®¹</div>
              <textarea id="myDiaryInput" class="field-textarea"
                        placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼æœ‰è¶£çš„äº‹ï¼Ÿ"></textarea>
            </div>

            <div class="diary-tools">
              <button type="button" class="chip-btn" id="myDiaryImageUploadBtn">
                å¾ç›¸ç°¿é¸æ“‡åœ–ç‰‡
              </button>
              <button type="button" class="chip-btn" id="myDiaryImageCameraBtn">
                æ‹ç…§ä¸Šå‚³
              </button>
              <input type="file" id="myDiaryImageUpload" accept="image/*"
                     style="display:none" />
              <input type="file" id="myDiaryImageCamera" accept="image/*" capture="environment"
                     style="display:none" />
            </div>

            <div class="range-row">
              <span class="range-label">ç…§ç‰‡é¡¯ç¤ºå¤§å°</span>
              <input type="range" id="myDiaryImageSize" min="40" max="100" value="80" />
              <span id="myDiaryImageSizeText" class="range-label">80%</span>
            </div>

            <div id="myDiaryPreview" class="diary-preview">
              <div class="field-label">é è¦½åœ–ç‰‡</div>
              <img id="myDiaryPreviewImg" alt="é è¦½åœ–ç‰‡" />
            </div>

            <div class="diary-limit">
              <span>ç›®å‰å·²ä½¿ç”¨ï¼š<span id="diaryUsedCount">0</span> /
                <span id="diaryLimitCount">5</span> å‰‡</span>
              <span id="diaryLimitNote" class="text-danger"></span>
            </div>

            <button id="myDiaryAddBtn" class="btn btn-primary btn-block" type="button">
              æ–°å¢æ—¥è¨˜
            </button>
          </div>

          <!-- åˆ—è¡¨å€ -->
          <div>
            <div class="section-title">å·²å¯«æ—¥è¨˜</div>
            <div id="myDiaryList" class="diary-list">
              <!-- å‹•æ…‹æ’å…¥ -->
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- åº•éƒ¨å°è¦½åˆ— -->
  <nav class="tab-bar">
    <div class="tab-bar-inner">
      <div class="tab-item active" data-target="page-match">
        <div>ğŸŒ¹</div>
        <span>å·§é‡</span>
      </div>
      <div class="tab-item" data-target="page-rank">
        <div>ğŸ‘‘</div>
        <span>æ’è¡Œæ¦œ</span>
      </div>
      <div class="tab-item" data-target="page-me">
        <div>ğŸ™‹â€â™‚ï¸</div>
        <span>æˆ‘çš„</span>
      </div>
    </div>
  </nav>
</div>

<script>
  /**********************
   * LocalStorage å·¥å…· *
   **********************/
  const LS_KEYS = {
    profile: 'hmUserProfile',
    diaries: 'hmMyDiaries',
    avatar: 'hmAvatarDataUrl',
    vip: 'hmVipLevel'
  };

  function hmLoadJSON(key, fallback) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return fallback;
      return JSON.parse(raw);
    } catch (e) {
      console.error('è§£æ localStorage å¤±æ•—', key, e);
      return fallback;
    }
  }

  function hmSaveJSON(key, value) {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (e) {
      console.error('å¯«å…¥ localStorage å¤±æ•—', key, e);
    }
  }

  /**********************
   * VIP èˆ‡æ—¥è¨˜ä¸Šé™     *
   **********************/
  function hmGetVipLevel() {
    const v = hmLoadJSON(LS_KEYS.vip, 0);
    return typeof v === 'number' ? v : 0;
  }

  function hmSetVipLevel(level) {
    hmSaveJSON(LS_KEYS.vip, level);
  }

  function hmGetDiaryLimit() {
    const vip = hmGetVipLevel();
    if (!vip || vip === 0) return 5;   // ä¸€èˆ¬ç”¨æˆ¶
    return 30;                         // VIP ä»»ä¸€ç­‰ç´š
  }

  function hmLoadDiaries() {
    return hmLoadJSON(LS_KEYS.diaries, []);
  }

  function hmSaveDiaries(list) {
    hmSaveJSON(LS_KEYS.diaries, list || []);
  }

  /**********************
   * é ç±¤åˆ‡æ›           *
   **********************/
  function initTabs() {
    const tabs = document.querySelectorAll('.tab-item');
    const pages = document.querySelectorAll('.page');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const targetId = tab.getAttribute('data-target');
        tabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        pages.forEach(p => {
          if (p.id === targetId) p.classList.add('active');
          else p.classList.remove('active');
        });
      });
    });
  }

  /**********************
   * å·§é‡ / æ’è¡Œæ¦œå‡è³‡æ–™ *
   **********************/
  function initMatchDemo() {
    const list = document.getElementById('matchList');
    const demo = [
      {
        name: 'Ariel',
        age: 28,
        city: 'å°ä¸­',
        img: 'https://images.pexels.com/photos/415829/pexels-photo-415829.jpeg?auto=compress&cs=tinysrgb&w=600'
      },
      {
        name: 'Jason',
        age: 32,
        city: 'é«˜é›„',
        img: 'https://images.pexels.com/photos/614810/pexels-photo-614810.jpeg?auto=compress&cs=tinysrgb&w=600'
      },
      {
        name: 'Mia',
        age: 24,
        city: 'å°åŒ—',
        img: 'https://images.pexels.com/photos/733872/pexels-photo-733872.jpeg?auto=compress&cs=tinysrgb&w=600'
      },
      {
        name: 'Leo',
        age: 30,
        city: 'èŠ±è“®',
        img: 'https://images.pexels.com/photos/91227/pexels-photo-91227.jpeg?auto=compress&cs=tinysrgb&w=600'
      }
    ];
    list.innerHTML = demo.map(m => `
      <div class="match-item">
        <img class="match-avatar" src="${m.img}" alt="${m.name}" />
        <div class="match-info">
          <div class="match-name">${m.name}</div>
          <div class="match-meta">${m.age} æ­²ãƒ»${m.city}</div>
        </div>
      </div>
    `).join('');
  }

  function initRankDemo() {
    const list = document.getElementById('rankList');
    const demo = [
      {
        rank: 1,
        name: 'å°é¹¿',
        score: 'ç¦®ç‰© 12,320',
        img: 'https://images.pexels.com/photos/733872/pexels-photo-733872.jpeg?auto=compress&cs=tinysrgb&w=600'
      },
      {
        rank: 2,
        name: 'è¥¿ç“œ',
        score: 'ç¦®ç‰© 9,880',
        img: 'https://images.pexels.com/photos/91227/pexels-photo-91227.jpeg?auto=compress&cs=tinysrgb&w=600'
      },
      {
        rank: 3,
        name: 'è€ç‹',
        score: 'ç¦®ç‰© 7,210',
        img: 'https://images.pexels.com/photos/614810/pexels-photo-614810.jpeg?auto=compress&cs=tinysrgb&w=600'
      }
    ];
    list.innerHTML = demo.map(r => `
      <div class="rank-item">
        <div class="rank-no">${r.rank}</div>
        <div class="rank-body">
          <img class="rank-avatar" src="${r.img}" alt="${r.name}" />
          <div>
            <div class="rank-name">${r.name}</div>
            <div class="rank-score">${r.score}</div>
          </div>
        </div>
      </div>
    `).join('');
  }

  /**********************
   * æˆ‘çš„è³‡æ–™ï¼šåŸºæœ¬è³‡æ–™ *
   **********************/
  function hmLoadProfile() {
    return hmLoadJSON(LS_KEYS.profile, {
      name: '',
      city: '',
      height: '',
      weight: '',
      ig: '',
      line: '',
      other: '',
      lockedBase: false
    });
  }

  function hmSaveProfile(profile) {
    hmSaveJSON(LS_KEYS.profile, profile);
  }

  function refreshProfileDisplay() {
    const p = hmLoadProfile();
    const vip = hmGetVipLevel();

    const displayName = document.getElementById('profileDisplayName');
    const meta1 = document.getElementById('profileDisplayMeta1');
    const meta2 = document.getElementById('profileDisplayMeta2');
    const statusTag = document.getElementById('profileStatusTag');
    const vipTag = document.getElementById('profileVipTag');
    const vipStatusText = document.getElementById('vipStatusText');

    // åç¨±
    displayName.textContent = p.name || 'æš±ç¨±æœªè¨­å®š';

    // åŸå¸‚
    const city = p.city || 'å±…ä½åœ°æœªè¨­å®š';
    meta1.textContent = 'å°ç£ãƒ»' + city;

    // èº«é«˜é«”é‡
    if (p.height && p.weight) {
      meta2.textContent = `${p.height} cm / ${p.weight} kg`;
    } else {
      meta2.textContent = 'èº«é«˜ / é«”é‡æœªè¨­å®š';
    }

    // VIP ç‹€æ…‹
    if (!vip || vip === 0) {
      statusTag.textContent = 'ä¸€èˆ¬ç”¨æˆ¶';
      vipTag.style.display = 'none';
      vipStatusText.textContent = 'ä¸€èˆ¬ç”¨æˆ¶ï¼ˆå…è²»ä¸Šé™ 5 å‰‡æ—¥è¨˜ï¼‰';
    } else {
      statusTag.textContent = 'VIP ç”¨æˆ¶';
      vipTag.style.display = 'inline-flex';
      vipStatusText.textContent = 'VIP ç”¨æˆ¶ï¼ˆå¯å¯« 30 å‰‡æ—¥è¨˜ï¼‰';
    }

    // è¡¨å–®å…§å®¹å›å¡«ï¼ˆç¤¾ç¾¤èˆ‡æœªé–å®šæ™‚çš„åŸºæœ¬è³‡æ–™ï¼‰
    document.getElementById('socialIg').value = p.ig || '';
    document.getElementById('socialLine').value = p.line || '';
    document.getElementById('socialOther').value = p.other || '';

    if (!p.lockedBase) {
      document.getElementById('baseName').value = p.name || '';
      document.getElementById('baseCity').value = p.city || '';
      document.getElementById('baseHeight').value = p.height || '';
      document.getElementById('baseWeight').value = p.weight || '';

      document.getElementById('baseProfileForm').style.display = 'block';
      document.getElementById('baseProfileLockedMsg').style.display = 'none';
    } else {
      document.getElementById('baseProfileForm').style.display = 'none';
      document.getElementById('baseProfileLockedMsg').style.display = 'block';
    }
  }

  function initProfile() {
    const profile = hmLoadProfile();
    const vipLevel = hmGetVipLevel();

    // VIP æ¸¬è©¦ä¸‹æ‹‰
    const vipSelect = document.getElementById('vipLevelSelect');
    vipSelect.value = String(vipLevel || 0);
    vipSelect.addEventListener('change', () => {
      const v = parseInt(vipSelect.value, 10) || 0;
      hmSetVipLevel(v);
      refreshProfileDisplay();
      refreshDiaryLimitUI();
    });

    // å„²å­˜åŸºæœ¬è³‡æ–™ä¸¦é–å®š
    const btnSaveBase = document.getElementById('btnSaveBaseProfile');
    btnSaveBase.addEventListener('click', () => {
      const name = document.getElementById('baseName').value.trim();
      const city = document.getElementById('baseCity').value;
      const height = document.getElementById('baseHeight').value.trim();
      const weight = document.getElementById('baseWeight').value.trim();

      if (!name || !city || !height || !weight) {
        alert('è«‹å®Œæ•´å¡«å¯«æš±ç¨± / åŸå¸‚ / èº«é«˜ / é«”é‡å¾Œå†å„²å­˜ã€‚');
        return;
      }

      const p = hmLoadProfile();
      p.name = name;
      p.city = city;
      p.height = height;
      p.weight = weight;
      p.lockedBase = true;
      hmSaveProfile(p);
      refreshProfileDisplay();
      alert('åŸºæœ¬è³‡æ–™å·²å„²å­˜ä¸¦é–å®šã€‚');
    });

    // å„²å­˜ç¤¾ç¾¤è³‡è¨Š
    const btnSaveSocial = document.getElementById('btnSaveSocial');
    btnSaveSocial.addEventListener('click', () => {
      const p = hmLoadProfile();
      p.ig = document.getElementById('socialIg').value.trim();
      p.line = document.getElementById('socialLine').value.trim();
      p.other = document.getElementById('socialOther').value.trim();
      hmSaveProfile(p);
      alert('ç¤¾ç¾¤è³‡è¨Šå·²å„²å­˜ã€‚');
    });

    // åˆªé™¤å¸³è™Ÿè³‡æ–™
    const btnReset = document.getElementById('btnResetProfile');
    btnReset.addEventListener('click', () => {
      if (!confirm('ç¢ºå®šè¦åˆªé™¤å¸³è™Ÿè³‡æ–™ï¼Ÿ\nå°‡æ¸…é™¤åŸºæœ¬è³‡æ–™ã€ç¤¾ç¾¤è³‡è¨Šã€æ—¥è¨˜èˆ‡é ­è²¼ã€‚')) return;
      localStorage.removeItem(LS_KEYS.profile);
      localStorage.removeItem(LS_KEYS.diaries);
      localStorage.removeItem(LS_KEYS.avatar);
      // VIP ä¸æ¸…é™¤ï¼Œè¦–ç‚ºè£ç½®èº«åˆ†ï¼›è‹¥è¦ä¸€èµ·æ¸…ç©ºå¯åŠ ä¸Šä¸‹ä¸€è¡Œ
      // localStorage.removeItem(LS_KEYS.vip);
      location.reload();
    });

    refreshProfileDisplay();
  }

  /**********************
   * é ­è²¼ä¸Šå‚³           *
   **********************/
  function initAvatarUpload() {
    const wrapper = document.getElementById('avatarWrapper');
    const fileInput = document.getElementById('avatarFileInput');
    const img = document.getElementById('avatarImg');

    // è¼‰å…¥å·²æœ‰é ­è²¼
    const stored = localStorage.getItem(LS_KEYS.avatar);
    if (stored) {
      img.src = stored;
    }

    wrapper.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        const dataUrl = ev.target.result;
        img.src = dataUrl;
        try {
          localStorage.setItem(LS_KEYS.avatar, dataUrl);
        } catch (err) {
          console.error('å„²å­˜é ­è²¼å¤±æ•—', err);
        }
      };
      reader.readAsDataURL(file);
    });
  }

  /**********************
   * æ—¥è¨˜ï¼šæ–°å¢ & é¡¯ç¤º  *
   **********************/
  let diaryTempImageDataUrl = null;

  function readFileAsDataURL(file, cb) {
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
      cb(e.target.result);
    };
    reader.readAsDataURL(file);
  }

  function refreshDiaryLimitUI() {
    const diaries = hmLoadDiaries();
    const used = diaries.length;
    const limit = hmGetDiaryLimit();
    const usedEl = document.getElementById('diaryUsedCount');
    const limitEl = document.getElementById('diaryLimitCount');
    const noteEl = document.getElementById('diaryLimitNote');

    usedEl.textContent = used;
    limitEl.textContent = limit;

    if (used >= limit) {
      noteEl.textContent = 'å·²é”æœ¬å¸³è™Ÿç›®å‰å¯ä½¿ç”¨çš„æ—¥è¨˜ä¸Šé™ã€‚';
    } else {
      noteEl.textContent = '';
    }
  }

  function renderMyDiaries() {
    const listEl = document.getElementById('myDiaryList');
    const diaries = hmLoadDiaries();

    refreshDiaryLimitUI();

    if (!diaries || diaries.length === 0) {
      listEl.innerHTML = '<div class="diary-empty">ç›®å‰é‚„æ²’æœ‰ä»»ä½•æ—¥è¨˜ï¼Œå¯«ä¸€ç¯‡è©¦è©¦çœ‹å§ã€‚</div>';
      return;
    }

    // ä¾å»ºç«‹æ™‚é–“ç”±æ–°åˆ°èˆŠæ’åº
    const sorted = diaries.slice().sort((a, b) => {
      return (b.createdAt || 0) > (a.createdAt || 0) ? 1 : -1;
    });

    listEl.innerHTML = sorted.map((d, index) => {
      const t = d.createdAt ? new Date(d.createdAt) : null;
      const dateStr = t
        ? t.toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit' }) +
          ' ' +
          t.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit' })
        : 'æ™‚é–“æœªçŸ¥';
      const size = d.imageSize || 80;
      const hasImage = !!d.image;
      const idxLabel = sorted.length - index; // åå‘ç·¨è™Ÿ
      return `
        <div class="diary-item">
          <div class="diary-meta">
            <span>#${idxLabel}ãƒ»${dateStr}</span>
            <span>${hasImage ? 'å«åœ–ç‰‡' : ''}</span>
          </div>
          <div class="diary-text">${(d.text || '').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
          ${hasImage ? `
            <div class="diary-image-wrap">
              <img src="${d.image}" alt="æ—¥è¨˜åœ–ç‰‡" style="width:${size}%;"/>
            </div>
            <div class="diary-image-note">åœ–ç‰‡é¡¯ç¤ºå¤§å°ï¼š${size}%</div>
          ` : ''}
        </div>
      `;
    }).join('');
  }

  function hmAddDiary() {
    const inputEl = document.getElementById('myDiaryInput');
    const text = inputEl.value.trim();
    const sizeEl = document.getElementById('myDiaryImageSize');
    const size = parseInt(sizeEl.value, 10) || 80;

    const list = hmLoadDiaries();
    const limit = hmGetDiaryLimit();

    // å…§å®¹é™åˆ¶ï¼šæ–‡å­— & åœ–ç‰‡è‡³å°‘ä¸€å€‹
    if (!text && !diaryTempImageDataUrl) {
      alert('è«‹å…ˆè¼¸å…¥æ–‡å­—æˆ–é¸æ“‡ä¸€å¼µåœ–ç‰‡å¾Œå†æ–°å¢ã€‚');
      return;
    }

    if (list.length >= limit) {
      alert('å·²é”ç›®å‰èº«åˆ†å¯ä½¿ç”¨çš„æ—¥è¨˜ä¸Šé™ï¼ˆæœ€å¤š ' + limit + ' å‰‡ï¼‰ã€‚');
      return;
    }

    const newDiary = {
      id: Date.now(),
      text: text,
      image: diaryTempImageDataUrl || null,
      imageSize: size,
      createdAt: new Date().toISOString()
    };

    list.push(newDiary);
    hmSaveDiaries(list);

    // æ¸…ç©ºè¼¸å…¥èˆ‡æš«å­˜åœ–ç‰‡
    inputEl.value = '';
    diaryTempImageDataUrl = null;
    const previewWrap = document.getElementById('myDiaryPreview');
    const previewImg = document.getElementById('myDiaryPreviewImg');
    previewImg.src = '';
    previewWrap.style.display = 'none';

    renderMyDiaries();
  }

  function initDiaryUI() {
    const addBtn = document.getElementById('myDiaryAddBtn');
    const uploadBtn = document.getElementById('myDiaryImageUploadBtn');
    const cameraBtn = document.getElementById('myDiaryImageCameraBtn');
    const uploadInput = document.getElementById('myDiaryImageUpload');
    const cameraInput = document.getElementById('myDiaryImageCamera');
    const range = document.getElementById('myDiaryImageSize');
    const rangeText = document.getElementById('myDiaryImageSizeText');
    const previewWrap = document.getElementById('myDiaryPreview');
    const previewImg = document.getElementById('myDiaryPreviewImg');

    range.addEventListener('input', () => {
      rangeText.textContent = range.value + '%';
    });

    uploadBtn.addEventListener('click', () => {
      uploadInput.click();
    });

    cameraBtn.addEventListener('click', () => {
      cameraInput.click();
    });

    function handleImageFile(file) {
      if (!file) return;
      readFileAsDataURL(file, (dataUrl) => {
        diaryTempImageDataUrl = dataUrl;
        previewImg.src = dataUrl;
        previewWrap.style.display = 'block';
      });
    }

    uploadInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      handleImageFile(file);
      uploadInput.value = '';
    });

    cameraInput.addEventListener('change', (e) => {
      const file = e.target.files && e.target.files[0];
      handleImageFile(file);
      cameraInput.value = '';
    });

    addBtn.addEventListener('click', hmAddDiary);

    // é¦–æ¬¡è¼‰å…¥æ™‚é¡¯ç¤ºæ—¢æœ‰æ—¥è¨˜
    renderMyDiaries();
  }

  /**********************
   * åˆå§‹åŒ–             *
   **********************/
  document.addEventListener('DOMContentLoaded', () => {
    initTabs();
    initMatchDemo();
    initRankDemo();
    initProfile();
    initAvatarUpload();
    initDiaryUI();
  });
</script>
</body>
</html>
