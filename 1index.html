background: #e5e7eb;
cursor: pointer;
}
    .album-item img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: filter 0.15s ease, transform 0.15s ease, opacity 0.15s ease;
    }
    /* è¢«é–ä½æ™‚ï¼šéœ§åŒ– + æç¤ºæ–‡å­— */
    .album-item.locked img {
      filter: blur(8px);
      transform: scale(1.06);
      opacity: 0.9;
    }
    .album-item.locked::after {
      content: "ğŸ”’ è§€çœ‹å»£å‘Šè§£é– 30 åˆ†é˜";
      position: absolute;
      left: 6px;
      right: 6px;
      bottom: 6px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.78);
      color: #f9fafb;
      font-size: 11px;
      text-align: center;
    }
.album-item img {
position: absolute;
inset: 0;
@@ -1561,6 +1588,24 @@ <h3 id="hm-profile-name">æœªè¨­å®šå§“å</h3>
</div>
</div>

  <!-- æ–°å¢ï¼šå¸³è™Ÿèˆ‡å®‰å…¨ / ç™»å‡º -->
  <div class="section">
    <div class="section-title">å¸³è™Ÿèˆ‡å®‰å…¨</div>
    <div class="diary-list">
      <div class="diary-item">
        <div style="font-size:16px; margin-bottom:6px;">
          è‹¥ä½ æ˜¯åœ¨ä»–äººè£ç½®ä¸Šä½¿ç”¨ï¼Œå»ºè­°é›¢é–‹å‰å…ˆç™»å‡ºï¼Œä»¥å…å€‹äººè³‡æ–™è¢«ä»–äººæŸ¥çœ‹ã€‚
        </div>
        <button id="hm-logout-btn" type="button" class="hm-btn-outline">
          ç™»å‡ºç›®å‰å¸³è™Ÿï¼ˆæ¸…é™¤æœ¬æ©Ÿæš«å­˜è³‡æ–™ï¼‰
        </button>
        <div style="margin-top:8px; font-size:13px; color:#9ca3af;">
          Demoï¼šç™»å‡ºæœƒæ¸…é™¤æœ¬æ©Ÿçš„ç¶å®šè³‡è¨Šã€åŸºæœ¬è³‡æ–™èˆ‡ç›¸ç°¿æš«å­˜ï¼Œä¸‹æ¬¡é€²å…¥æ™‚æœƒé‡æ–°è·³å‡ºç¶å®šèˆ‡å¡«å¯«è³‡æ–™çš„è¦–çª—ã€‚
        </div>
      </div>
    </div>
  </div>

<div class="section">
<div class="section-title">æˆ‘çš„æ—¥è¨˜ï¼ˆç¤ºæ„ï¼Œä¹‹å¾Œå¯é™åˆ¶å…è²» 5 ç¯‡ï¼‰</div>
<div class="diary-list">
@@ -1827,6 +1872,7 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
}
];

  // é è¨­ç›¸ç°¿ç…§ç‰‡ï¼ˆç•¶ä½¿ç”¨è€…å°šæœªè‡ªå·±ä¸Šå‚³æ™‚ï¼Œç•¶ä½œåº•åœ–ï¼‰
const albumPhotos = [
"https://picsum.photos/400/400?random=901",
"https://picsum.photos/400/400?random=902",
@@ -1843,6 +1889,7 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
const topRightSlot = document.getElementById("topRightSlot");

let currentBatch = [];
  let currentProfileId = null; // ç›®å‰æ­£åœ¨æŸ¥çœ‹çš„æª”æ¡ˆ idï¼ˆçµ¦ç›¸ç°¿è§£é–å¾Œé‡åˆ·ç”¨ï¼‰

function shuffleArray(arr) {
const copy = arr.slice();
@@ -1920,6 +1967,7 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
function openProfileDetail(id) {
const p = people.find(x => x.id === id);
if (!p) return;
    currentProfileId = id;

let statusClass = "status-badge";
if (p.status === "busy") statusClass += " status-busy";
@@ -1931,13 +1979,24 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
'<span class="' + statusClass + '"><span class="status-dot"></span><span>' +
(p.statusText || "å·²ä¸Šç·š") + "</span></span>";

    const albumHtml = albumPhotos.map((src, idx) => `
      <div class="album-item" onclick="openPhotoViewer('${src}')">
        <img src="${src}" alt="photo${idx+1}" />
        <button class="set-cover-btn" onclick="event.stopPropagation(); setAsAvatar(${idx})">è¨­ç‚ºé ­è²¼</button>
        <div class="album-gift-btn" onclick="event.stopPropagation(); sendGiftAnimation(this)">ğŸ’ é€ç¦®</div>
      </div>
    `).join("");
    // ä½¿ç”¨ã€Œæˆ‘çš„ç…§ç‰‡ã€ç‚ºåŸºç¤ï¼Œé™Œç”Ÿäººçœ‹åˆ°çš„å°±æ˜¯é€™ 6 å¼µ
    const totalSlots = (typeof MY_ALBUM_SLOTS === "number" ? MY_ALBUM_SLOTS : 6);
    const vipLevel = hmGetVipLevel();
    const unlocked = hmAlbumIsUnlocked();

    const albumHtml = Array.from({ length: totalSlots }).map((_, idx) => {
      const src = hmGetAlbumPhotoSrc(idx);
      const isFree = idx < 2;
      const isLocked = !isFree && vipLevel === 0 && !unlocked;
      const lockedClass = isLocked ? " locked" : "";
      return `
        <div class="album-item${lockedClass}" onclick="handleStrangerAlbumClick(${idx})">
          <img src="${src}" alt="photo${idx + 1}" />
          <button class="set-cover-btn" onclick="event.stopPropagation(); setAsAvatar(${idx})">è¨­ç‚ºé ­è²¼</button>
          <div class="album-gift-btn" onclick="event.stopPropagation(); sendGiftAnimation(this)">ğŸ’ é€ç¦®</div>
        </div>
      `;
    }).join("");

profileDetailContent.innerHTML = `
     <div class="profile-header">
@@ -1970,7 +2029,8 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
         ${albumHtml}
       </div>
       <div class="album-note">
          ç›¸ç°¿åƒ…ç¤ºæ„ï¼Œæ­£å¼ç‰ˆå¯ä»¥ä¸Šå‚³è‡ªå·±çš„ç…§ç‰‡ã€è¨­å®šå¯è¦‹ç¯„åœèˆ‡è§£é–æ–¹å¼ã€‚
          ç›¸ç°¿åƒ…ç¤ºæ„ï¼Œæ­£å¼ç‰ˆå¯ä»¥ä¸Šå‚³è‡ªå·±çš„ç…§ç‰‡ã€è¨­å®šå¯è¦‹ç¯„åœèˆ‡è§£é–æ–¹å¼ã€‚<br/>
          Demoï¼šå‰å…©å¼µç‚ºå…è²»é è¦½ï¼Œå¾Œå››å¼µéœ€è§€çœ‹å»£å‘Šæ‰å¯åœ¨ 30 åˆ†é˜å…§è§£é–ã€‚
       </div>
     </div>

@@ -2388,10 +2448,10 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
alert("é€™é‚Šä¹‹å¾Œæœƒæ‰“é–‹é€ç¦®ç‰©é¢æ¿ã€‚");
}
function setAsAvatar(idx) {
    const newAvatar = albumPhotos[idx];
    const newAvatar = hmGetAlbumPhotoSrc(idx);
const avatarImg = document.querySelector(".profile-avatar img");
if (avatarImg) avatarImg.src = newAvatar;
    alert("å·²æŠŠé€™å¼µç…§ç‰‡è¨­ç‚ºé ­è²¼ï¼");
    alert("å·²æŠŠé€™å¼µç…§ç‰‡è¨­ç‚ºé ­è²¼ï¼ï¼ˆDemoï¼‰");
}
function markViewing() {
alert("å·²æ¨™è¨˜ã€Œæ­£åœ¨æ¬£è³å¥¹ã€ã€‚ä¹‹å¾Œå¯ä»¥æŠŠé€™å€‹ç‹€æ…‹åŒæ­¥åˆ°å¾Œç«¯ã€‚");
@@ -2527,6 +2587,7 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
{ key: "other", label: "å…¶ä»–", short: "?", className: "hm-social-other" }
];

    socialListEl.innerHTML = "";
config.forEach((c) => {
const rawValue = socials[c.key];
if (!rawValue || !rawValue.trim) return;
@@ -2542,7 +2603,6 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
});
});

    socialListEl.innerHTML = "";
if (items.length === 0) {
const span = document.createElement("span");
span.className = "hm-profile-social-empty";
@@ -2600,6 +2660,10 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
} catch (e) {}
hmUpdateVipUI();
renderMyAlbum();
    // VIP è®Šå‹•æ™‚ä¹Ÿåˆ·æ–°ç›®å‰æª”æ¡ˆ
    if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
      openProfileDetail(currentProfileId);
    }
}

function hmUpdateVipUI() {
@@ -2652,21 +2716,53 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
}
}

  // å–å¾—è§£é–åˆ°æœŸæ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
  function hmAlbumGetUnlockUntil() {
    try {
      const raw = localStorage.getItem("hmAlbumUnlockUntil");
      const t = parseInt(raw || "0", 10);
      return isNaN(t) ? 0 : t;
    } catch (e) {
      return 0;
    }
  }

  // åˆ¤æ–·ç›®å‰æ˜¯å¦å·²è§£é–ï¼ˆVIP ç›´æ¥è¦–ç‚ºæ°¸ä¹…è§£é–ï¼‰
function hmAlbumIsUnlocked() {
if (hmGetVipLevel() > 0) return true;
    const until = hmAlbumGetUnlockUntil();
    return until > Date.now();
  }

  // Demoï¼šçœ‹å®Œå»£å‘Šè§£é– 30 åˆ†é˜
  function hmAlbumUnlockFor30Minutes() {
    const unlockUntil = Date.now() + 30 * 60 * 1000;
try {
      return sessionStorage.getItem("hmAlbumUnlocked") === "true";
      localStorage.setItem("hmAlbumUnlockUntil", String(unlockUntil));
} catch (e) {
      return false;
      console.warn("å„²å­˜ç›¸ç°¿è§£é–æ™‚é–“å¤±æ•—ï¼š", e);
    }
    alert("Demoï¼šå‡è¨­ä½ çœ‹å®Œä¸€æ®µå»£å‘Šï¼Œæ¥ä¸‹ä¾† 30 åˆ†é˜å…§ 6 å¼µç…§ç‰‡éƒ½æœƒé–‹æ”¾çµ¦é™Œç”Ÿäººèˆ‡å¥½å‹æŸ¥çœ‹ã€‚");
    renderMyAlbum();
    if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
      openProfileDetail(currentProfileId);
}
}

  // èˆŠå‡½å¼åç¨±çš„åˆ¥åï¼ˆé¿å…éºæ¼ï¼‰
function hmAlbumUnlock() {
    try {
      sessionStorage.setItem("hmAlbumUnlocked", "true");
    } catch (e) {}
    alert("Demoï¼šå‡è¨­ä½ çœ‹å®Œä¸€æ®µå»£å‘Šï¼Œç¾åœ¨æš«æ™‚è§£é– 4 å¼µç…§ç‰‡ï¼Œé‡æ–°æ•´ç†æˆ–é—œé–‰ç€è¦½å™¨å¾Œæœƒå†é–å›å»ã€‚");
    renderMyAlbum();
    hmAlbumUnlockFor30Minutes();
  }

  // å–å¾—æŸä¸€æ ¼ç…§ç‰‡çœŸæ­£è¦é¡¯ç¤ºçš„ srcï¼š
  // å…ˆç”¨ä½¿ç”¨è€…ä¸Šå‚³çš„ï¼Œæ²’æœ‰çš„è©±ç”¨é è¨­ picsum ç•¶åº•åœ–
  function hmGetAlbumPhotoSrc(idx) {
    const photos = hmLoadAlbumPhotos();
    const fallback = albumPhotos;
    const p = photos[idx];
    if (p) return p;
    if (fallback && fallback[idx]) return fallback[idx];
    return "https://picsum.photos/400/400?random=" + (901 + idx);
}

function renderMyAlbum() {
@@ -2687,9 +2783,9 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>

const img = document.createElement("img");
img.id = "myAlbumImg_" + i;
      if (photos[i]) {
        img.src = photos[i];
      } else {
      const src = hmGetAlbumPhotoSrc(i);
      img.src = src || "";
      if (!photos[i]) {
img.style.opacity = "0.3";
}
slot.appendChild(img);
@@ -2703,7 +2799,7 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
}
slot.appendChild(label);

      // ä¸Šå‚³æŒ‰éˆ• + input
      // ä¸Šå‚³æŒ‰éˆ• + inputï¼ˆè‡ªå·±çœ‹å¾—åˆ°ï¼‰
const fileInput = document.createElement("input");
fileInput.type = "file";
fileInput.accept = "image/*";
@@ -2733,6 +2829,10 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
myAlbumPhotosCache = arr;
hmSaveAlbumPhotos();
renderMyAlbum();
          // è‡ªå·±ç…§ç‰‡æ”¹äº†ï¼Œä¹Ÿåˆ·æ–°ç›®å‰æª”æ¡ˆ
          if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
            openProfileDetail(currentProfileId);
          }
};
reader.readAsDataURL(file);
});
@@ -2742,15 +2842,15 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
const overlay = document.createElement("div");
overlay.className = "my-album-lock-overlay";
overlay.innerHTML = `
          <div>ğŸ”’ é–å®šç…§ç‰‡<br>è§€çœ‹ä¸€æ¬¡å»£å‘Šå³å¯æš«æ™‚è§£é– 4 å¼µç…§ç‰‡</div>
          <div>ğŸ”’ é–å®šç…§ç‰‡<br>è§€çœ‹ä¸€æ¬¡å»£å‘Šå³å¯åœ¨ 30 åˆ†é˜å…§è§£é– 6 å¼µç…§ç‰‡</div>
       `;
const btn = document.createElement("button");
btn.type = "button";
btn.className = "my-album-lock-btn";
btn.textContent = "è§€çœ‹å»£å‘Šæš«æ™‚è§£é–ï¼ˆDemoï¼‰";
btn.addEventListener("click", (e) => {
e.stopPropagation();
          hmAlbumUnlock();
          hmAlbumUnlockFor30Minutes();
});
overlay.appendChild(btn);
slot.appendChild(overlay);
@@ -2760,6 +2860,26 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
}
}

  // é™Œç”Ÿäººé»æ“Šç›¸ç°¿ç…§ç‰‡æ™‚çš„é‚è¼¯ï¼š
  // å‰å…©å¼µï¼šç›´æ¥çœ‹ï¼›VIPï¼šå…¨éƒ¨ç›´æ¥çœ‹ï¼›å…¶é¤˜ï¼šçœ‹å»£å‘Šâ†’è§£é– 30 åˆ†é˜
  function hmShowAlbumAdPrompt() {
    const go = confirm("é€™ 4 å¼µç…§ç‰‡éœ€è§€çœ‹ä¸€æ®µå»£å‘Šæ‰èƒ½åœ¨ 30 åˆ†é˜å…§è§£é–ã€‚\nè¦å‰å¾€å»£å‘Šé ï¼ˆDemoï¼‰å—ï¼Ÿ");
    if (!go) return;
    // Demoï¼šé–‹ä¸€å€‹å‡å»£å‘Šé ï¼ˆæ­£å¼ç‰ˆæ¥å»£å‘Š SDK å³å¯ï¼‰
    window.open("https://example.com", "_blank");
    hmAlbumUnlockFor30Minutes();
  }

  function handleStrangerAlbumClick(idx) {
    const vip = hmGetVipLevel();
    if (idx < 2 || vip > 0 || hmAlbumIsUnlocked()) {
      openPhotoViewer(hmGetAlbumPhotoSrc(idx));
    } else {
      hmShowAlbumAdPrompt();
    }
  }
  window.handleStrangerAlbumClick = handleStrangerAlbumClick;

document.addEventListener("DOMContentLoaded", function () {
pickRandomBatch();
renderPeopleGrid();
@@ -2870,6 +2990,28 @@ <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
profileModal.style.display = "flex";
});
}

    // ç™»å‡ºæŒ‰éˆ•ï¼šæ¸…é™¤æœ¬æ©Ÿè³‡æ–™ + é‡æ•´
    const logoutBtn = document.getElementById("hm-logout-btn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", function () {
        if (!confirm("ç¢ºå®šè¦ç™»å‡ºä¸¦æ¸…é™¤æœ¬æ©Ÿçš„æš«å­˜è³‡æ–™å—ï¼Ÿ\nï¼ˆåŒ…å«åŸºæœ¬è³‡æ–™ã€ç¶å®šç³»çµ±ã€VIP ç­‰ç´šèˆ‡ç›¸ç°¿ç…§ç‰‡ Demo è³‡æ–™ï¼‰")) {
          return;
        }
        try {
          localStorage.removeItem("hmProfileData");
          localStorage.removeItem("hmProfileCompleted");
          localStorage.removeItem("hmAuthProvider");
          localStorage.removeItem("hmVipLevel");
          localStorage.removeItem("hmMyAlbumPhotos");
          localStorage.removeItem("hmAlbumUnlockUntil");
          sessionStorage.removeItem("hmAlbumUnlocked"); // èˆŠç‰ˆä¿éšª
        } catch (e) {
          console.warn("ç™»å‡ºæ™‚æ¸…é™¤ localStorage / sessionStorage å¤±æ•—ï¼š", e);
        }
        location.reload();
      });
    }
});
</script>
</body>
