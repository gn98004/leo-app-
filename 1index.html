<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å¿ƒé‡ XinYou - Demo V3</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", "Microsoft JhengHei", sans-serif;
      background: #f3f4f6;
      color: #111827;
      font-size: 18px;
    }

    /* é ‚éƒ¨åˆ— */
    .top-bar {
      position: sticky;
      top: 0;
      z-index: 30;
      height: 60px;
      padding: 0 16px;
      background: #ffffff;
      border-bottom: 0.5px solid #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .top-bar-inner {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }
    .top-title {
      font-size: 22px;
      font-weight: 700;
    }
    .top-right {
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .icon-button {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: none;
      background: #f3f4f6;
      cursor: pointer;
    }
    .icon-gear {
      width: 22px;
      height: 22px;
      opacity: 0.8;
    }

    .page {
      display: none;
      padding-bottom: 72px;
    }
    .page.active {
      display: block;
    }

    .card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 2px 4px rgba(15,23,42,0.08);
    }

    /* äººå€‘ (2x2) */
    .people-wrapper {
      padding: 14px 14px 6px;
    }
    .people-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 14px;
    }
    .people-card {
      border-radius: 18px;
      overflow: hidden;
      background: #ffffff;
      box-shadow: 0 2px 5px rgba(15, 23, 42, 0.12);
      cursor: pointer;
      display: flex;
      flex-direction: column;
    }
    .people-photo {
      width: 100%;
      padding-top: 140%;
      position: relative;
      background: #e5e7eb;
      overflow: hidden;
    }
    .people-photo img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .people-info {
      padding: 8px 10px 10px;
    }
    .people-name-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .people-name {
      font-size: 18px;
      font-weight: 700;
    }
    .people-age {
      font-size: 14px;
      color: #6b7280;
    }
    .people-desc {
      margin-top: 6px;
      font-size: 14px;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .status-badge {
      margin-top: 6px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 10px;
      font-size: 13px;
      border-radius: 999px;
      background: #e5f9e7;
      color: #16a34a;
    }
    .status-dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #22c55e;
    }
    .status-busy {
      background: #fef9c3;
      color: #ca8a04;
    }
    .status-busy .status-dot { background: #eab308; }
    .status-away {
      background: #e5e7eb;
      color: #4b5563;
    }
    .status-away .status-dot { background: #6b7280; }
    .status-eating {
      background: #fee2e2;
      color: #b91c1c;
    }
    .status-eating .status-dot { background: #dc2626; }
    .status-shower {
      background: #e0f2fe;
      color: #0369a1;
    }
    .status-shower .status-dot { background: #0284c7; }

    .pager {
      display: flex;
      justify-content: center;
      padding: 10px 0 6px;
    }
    .pager-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 18px;
      font-size: 16px;
      background: #ffffff;
      cursor: pointer;
      color: #374151;
    }
    .pager-btn:hover {
      background: #f3f4f6;
    }

    /* å¥½å‹ */
    .tabs-row {
      display: flex;
      background: #ffffff;
      border-bottom: 0.5px solid #e5e7eb;
    }
    .tab-btn {
      flex: 1;
      text-align: center;
      padding: 10px 0;
      font-size: 16px;
      cursor: pointer;
      color: #6b7280;
    }
    .tab-btn.active {
      color: #2563eb;
      border-bottom: 3px solid #2563eb;
      font-weight: 700;
    }
    .list {
      list-style: none;
      margin: 0;
      padding: 0;
      background: #ffffff;
    }
    .list-item {
      display: flex;
      padding: 12px 16px;
      border-bottom: 0.5px solid #f0f0f0;
      cursor: pointer;
    }
    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 18px;
      overflow: hidden;
      margin-right: 12px;
      background: #e5e7eb;
      flex-shrink: 0;
    }
    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .item-main {
      flex: 1;
      min-width: 0;
    }
    .item-row1 {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .item-row1-left {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .item-name {
      font-size: 18px;
      font-weight: 700;
    }
    .item-mood {
      font-size: 22px;
    }
    .item-row2 {
      margin-top: 4px;
      font-size: 14px;
      color: #6b7280;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-row3 {
      margin-top: 4px;
      font-size: 14px;
      color: #4b5563;
    }
    .item-row3 span.label {
      color: #9ca3af;
      margin-right: 4px;
    }
    .status-inline {
      margin-left: 4px;
    }

    /* è©³ç´°æª”æ¡ˆ & ç›¸ç°¿ */
    .profile-header {
      padding: 14px 16px;
      background: #ffffff;
      border-bottom: 0.5px solid #e5e7eb;
    }
    .profile-row-main {
      display: flex;
      align-items: center;
    }
    .profile-avatar {
      width: 80px;
      height: 80px;
      border-radius: 22px;
      overflow: hidden;
      margin-right: 14px;
      background: #e5e7eb;
      flex-shrink: 0;
    }
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .profile-name {
      font-size: 22px;
      font-weight: 700;
    }
    .profile-sub {
      margin-top: 4px;
      font-size: 16px;
      color: #6b7280;
    }
    .profile-actions {
      margin-top: 12px;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      flex-wrap: wrap;
    }
    .btn {
      border-radius: 12px;
      border: 1px solid #d1d5db;
      padding: 7px 12px;
      font-size: 16px;
      background: #f9fafb;
      cursor: pointer;
    }
    .btn-primary {
      border-color: #2563eb;
      background: #2563eb;
      color: #ffffff;
    }
    .btn-sm {
      padding: 4px 8px;
      font-size: 13px;
      border-radius: 999px;
      margin-right: 6px;
    }

    .section {
      margin-top: 12px;
      background: #ffffff;
      border-top: 0.5px solid #e5e7eb;
      border-bottom: 0.5px solid #e5e7eb;
    }
    .section-title {
      padding: 10px 16px;
      font-size: 18px;
      font-weight: 700;
      color: #374151;
      border-bottom: 0.5px solid #f3f4f6;
    }

    /* æ–°ï¼šå…©é¡†å¤§æŒ‰éˆ• */
    .profile-cta-row {
      padding: 12px 16px 14px;
      display: flex;
      gap: 10px;
    }
    .big-cta-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      font-size: 17px;
      padding: 10px 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    .big-cta-btn.secondary {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      color: #374151;
    }
    .big-cta-btn.primary {
      background: #f97316;
      color: #ffffff;
      box-shadow: 0 4px 12px rgba(248, 148, 60, 0.45);
    }

    /* ç›¸ç°¿å€å¡Šï¼ˆåˆ¥äººæª”æ¡ˆç”¨ï¼‰ */
    .album-grid {
      padding: 12px 16px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .album-item {
      position: relative;
      width: 100%;
      padding-top: 100%;
      border-radius: 14px;
      overflow: hidden;
      background: #e5e7eb;
      cursor: pointer;
    }
    .album-item img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: filter 0.15s ease, transform 0.15s ease, opacity 0.15s ease;
    }
    .album-item.locked img {
      filter: blur(8px);
      transform: scale(1.06);
      opacity: 0.9;
    }
    .album-item.locked::after {
      content: "ğŸ”’ è§€çœ‹å»£å‘Šè§£é– 30 åˆ†é˜";
      position: absolute;
      left: 6px;
      right: 6px;
      bottom: 6px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(15,23,42,0.78);
      color: #f9fafb;
      font-size: 11px;
      text-align: center;
    }
    .set-cover-btn {
      position: absolute;
      bottom: 4px;
      right: 4px;
      background: rgba(0,0,0,0.55);
      color: white;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 10px;
      border: none;
      display: none;
    }
    .album-item:hover .set-cover-btn {
      display: inline-block;
    }
    .album-gift-btn {
      position: absolute;
      left: 4px;
      bottom: 4px;
      background: rgba(248, 113, 113, 0.92);
      color: #fff;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 999px;
      border: none;
    }
    .album-note {
      font-size: 13px;
      color: #6b7280;
      padding: 0 16px 12px;
    }

    /* å…¨è¢å¹•åœ–ç‰‡ Viewer */
    .photo-viewer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.9);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .photo-viewer.show {
      display: flex;
    }
    .photo-viewer img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 8px;
    }
    .photo-viewer-close {
      position: fixed;
      top: 14px;
      right: 14px;
      color: white;
      font-size: 30px;
      cursor: pointer;
    }

    /* é€ç¦®å‹•ç•« */
    .gift-heart {
      position: fixed;
      font-size: 28px;
      pointer-events: none;
      animation: floatUp 1s ease-out forwards;
      z-index: 2100;
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-70px) scale(1.5); }
    }

    /* åŸºæœ¬è³‡æ–™ + æ—¥è¨˜ */
    .info-table {
      width: 100%;
      border-collapse: collapse;
    }
    .info-table tr {
      border-bottom: 0.5px solid #f3f4f6;
    }
    .info-key {
      width: 90px;
      padding: 10px 16px;
      font-size: 16px;
      color: #6b7280;
    }
    .info-value {
      padding: 10px 16px 10px 0;
      font-size: 16px;
    }
    .diary-list {
      padding: 8px 16px 12px;
    }
    .diary-item {
      padding: 7px 0;
      border-bottom: 0.5px dashed #e5e7eb;
      font-size: 16px;
    }
    .diary-item:last-child {
      border-bottom: none;
    }
    .diary-date {
      font-size: 13px;
      color: #9ca3af;
      margin-bottom: 3px;
    }

    /* èŠå¤©é  */
    .chat-wrapper {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 60px - 64px);
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px 12px 6px;
    }
    .bubble-row {
      display: flex;
      margin-bottom: 8px;
    }
    .bubble-row.me {
      justify-content: flex-end;
    }
    .bubble {
      max-width: 74%;
      padding: 10px 12px;
      border-radius: 20px;
      font-size: 16px;
      line-height: 1.5;
      background: #ffffff;
      border: 0.5px solid #e5e7eb;
    }
    .bubble.them {
      background: #ffffff;
      border: 0.5px solid #e5e7eb;
    }
    .bubble.me {
      background: #4ade80;
      color: #064e3b;
    }
    .chat-image {
      max-width: 220px;
      max-height: 220px;
      border-radius: 12px;
      display: block;
    }

    .chat-theme-bar {
      display: flex;
      padding: 8px 10px 0;
      gap: 8px;
      background: transparent;
    }
    .chat-theme-pill {
      flex: 1;
      text-align: center;
      font-size: 14px;
      padding: 6px 0;
      border-radius: 999px;
      cursor: pointer;
      border: 1px solid #d1d5db;
      background: #ffffff;
    }
    .chat-theme-pill.active {
      background: #111827;
      color: #f9fafb;
      border-color: #111827;
    }

    .chat-theme-light .chat-messages { background: #f3f4f6; }
    .chat-theme-pink .chat-messages { background: #fef2f2; }
    .chat-theme-blue .chat-messages { background: #eff6ff; }
    .chat-theme-dark .chat-messages { background: #030712; }
    .chat-theme-dark .bubble.them {
      background: #111827;
      color: #e5e7eb;
      border-color: #111827;
    }

    .chat-input-area {
      background: #f9fafb;
      border-top: 0.5px solid #e5e7eb;
    }

    .chat-more-menu {
      display: none;
      padding: 6px 10px;
      border-bottom: 0.5px solid #e5e7eb;
      background: #ffffff;
      gap: 8px;
      flex-wrap: wrap;
    }
    .chat-more-menu.show {
      display: flex;
    }
    .chat-more-btn {
      font-size: 14px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      cursor: pointer;
    }

    .chat-sticker-bar {
      display: none;
      padding: 6px 10px 4px;
      border-bottom: 0.5px solid #e5e7eb;
      background: #ffffff;
    }
    .chat-sticker-bar.show {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .sticker-btn {
      font-size: 24px;
      padding: 4px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      cursor: pointer;
    }

    .chat-input-bar {
      display: flex;
      padding: 8px 10px;
      align-items: center;
      gap: 8px;
    }
    .chat-input {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 8px 14px;
      font-size: 16px;
      outline: none;
      background: #ffffff;
    }
    .chat-send-btn {
      padding: 8px 14px;
      font-size: 16px;
      border-radius: 999px;
      border: none;
      background: #2563eb;
      color: #ffffff;
      cursor: pointer;
    }
    .chat-plus-btn {
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      background: #e5e7eb;
      cursor: pointer;
      font-size: 20px;
    }

    /* æˆ‘çš„æª”æ¡ˆ */
    .my-section-note {
      font-size: 14px;
      color: #6b7280;
      padding: 0 16px 12px;
    }
    .form-list {
      background: #ffffff;
      border-top: 0.5px solid #e5e7eb;
      border-bottom: 0.5px solid #e5e7eb;
    }
    .form-row {
      padding: 12px 16px;
      border-bottom: 0.5px solid #f3f4f6;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 16px;
    }
    .form-row:last-child { border-bottom: none; }
    .form-label { color: #374151; }
    .form-value { color: #6b7280; }

    .toggle {
      width: 46px;
      height: 26px;
      border-radius: 999px;
      background: #e5e7eb;
      position: relative;
      cursor: pointer;
    }
    .toggle-knob {
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: #ffffff;
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      transition: all 0.16s ease;
    }
    .toggle.on { background: #22c55e; }
    .toggle.on .toggle-knob { left: 23px; }

    select, textarea {
      font-size: 15px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      background: #f9fafb;
      width: 100%;
      outline: none;
    }
    textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* èª°ä¾†çœ‹éæˆ‘ */
    .footprint-list {
      padding: 8px 16px 12px;
    }
    .footprint-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 15px;
    }
    .footprint-avatar {
      width: 38px;
      height: 38px;
      border-radius: 999px;
      overflow: hidden;
      background: #e5e7eb;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .footprint-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .footprint-main {
      flex: 1;
    }
    .footprint-name {
      font-weight: 600;
    }
    .footprint-sub {
      font-size: 13px;
      color: #6b7280;
    }

    /* æ’è¡Œæ¦œ */
    .rank-wrapper {
      padding: 10px 12px 14px;
    }
    .rank-tabs {
      display: flex;
      background: #ffffff;
      border-radius: 999px;
      padding: 4px;
      margin: 4px 10px 12px;
      box-shadow: 0 2px 4px rgba(15,23,42,0.08);
    }
    .rank-tab {
      flex: 1;
      text-align: center;
      font-size: 15px;
      padding: 6px 0;
      border-radius: 999px;
      cursor: pointer;
      color: #6b7280;
    }
    .rank-tab.active {
      background: #111827;
      color: #f9fafb;
      font-weight: 700;
    }
    .rank-pyramid-card {
      padding: 12px 10px 16px;
    }
    .rank-row {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
      gap: 16px;
    }
    .rank-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      background: #fef3c7;
      color: #92400e;
    }
    .rank-badge span.icon {
      font-size: 18px;
    }
    .rank-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .rank-avatar-wrap {
      border-radius: 999px;
      padding: 3px;
      background: linear-gradient(135deg, #fde68a, #fbbf24);
      box-shadow: 0 0 0 2px rgba(250, 204, 21, 0.4);
    }
    .rank-avatar-wrap.king {
      padding: 4px;
      box-shadow: 0 0 0 3px rgba(250, 204, 21, 0.6);
    }
    .rank-avatar {
      width: 110px;
      height: 110px;
      border-radius: 999px;
      overflow: hidden;
      background: #e5e7eb;
    }
    .rank-avatar.medium {
      width: 80px;
      height: 80px;
    }
    .rank-avatar.small {
      width: 65px;
      height: 65px;
    }
    .rank-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .rank-name {
      font-size: 16px;
      font-weight: 700;
      margin-top: 6px;
    }
    .rank-sub {
      font-size: 14px;
      color: #6b7280;
    }

    .rank-list {
      margin-top: 10px;
      background: #ffffff;
      border-radius: 18px;
      overflow: hidden;
      border: 0.5px solid #e5e7eb;
    }
    .rank-list-item {
      display: flex;
      align-items: center;
      padding: 10px 14px;
      border-bottom: 0.5px solid #f3f4f6;
      font-size: 15px;
    }
    .rank-list-item:last-child { border-bottom: none; }
    .rank-pos {
      width: 26px;
      color: #6b7280;
    }
    .rank-list-avatar {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      overflow: hidden;
      background: #e5e7eb;
      margin-right: 10px;
      flex-shrink: 0;
    }
    .rank-list-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .rank-list-main {
      flex: 1;
      min-width: 0;
    }
    .rank-list-name {
      font-weight: 600;
    }
    .rank-list-sub {
      font-size: 13px;
      color: #9ca3af;
    }
    .rank-score {
      font-size: 13px;
      color: #4b5563;
    }
    .rank-note {
      margin-top: 10px;
      font-size: 13px;
      color: #6b7280;
      text-align: center;
      padding: 0 10px;
    }

    /* åº•éƒ¨å°è¦½ */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      height: 64px;
      background: #ffffff;
      border-top: 0.5px solid #e5e7eb;
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 40;
    }
    .nav-item {
      flex: 1;
      text-align: center;
      font-size: 12px;
      color: #9ca3af;
      cursor: pointer;
    }
    .nav-item-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
    }
    .nav-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #d1d5db;
      font-size: 16px;
      font-weight: 700;
      background: #f9fafb;
    }
    .nav-item.active {
      color: #2563eb;
    }
    .nav-item.active .nav-icon {
      border-color: #2563eb;
      background: #eff6ff;
      color: #2563eb;
    }

    /* ================== åŸºæœ¬è³‡æ–™å½ˆçª— & ç™»å…¥ ================== */
    .hm-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(3px);
    }
    .hm-modal {
      width: 90%;
      max-width: 420px;
      max-height: 90vh;
      background: #ffffff;
      border-radius: 18px;
      padding: 20px 18px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .hm-modal-header h2 {
      font-size: 20px;
      margin: 0 0 4px 0;
    }
    .hm-modal-header p {
      margin: 0 0 12px 0;
      font-size: 13px;
      color: #666;
    }
    .hm-form-group {
      margin-bottom: 14px;
    }
    .hm-form-group label {
      display: block;
      font-size: 14px;
      margin-bottom: 4px;
    }
    .hm-required {
      color: #e53935;
    }
    .hm-form-group input[type="text"],
    .hm-form-group input[type="number"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
      box-sizing: border-box;
    }
    .hm-form-group input:focus {
      outline: none;
      border-color: #ff3b81;
      box-shadow: 0 0 0 1px rgba(255, 59, 129, 0.15);
    }
    .hm-inline {
      display: flex;
      gap: 10px;
    }
    .hm-inline > div {
      flex: 1;
    }
    .hm-checkbox-group label {
      display: flex;
      align-items: center;
      font-size: 13px;
      gap: 6px;
    }
    .hm-checkbox-group input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }
    .hm-help-text {
      font-size: 11px;
      color: #888;
      margin: 2px 0 6px 0;
    }
    .hm-social-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    .hm-social-label {
      display: inline-block;
      min-width: 78px;
      font-size: 12px;
      color: #444;
    }
    .hm-modal-footer {
      margin-top: 14px;
      text-align: center;
    }
    .hm-btn-primary {
      width: 100%;
      padding: 10px 0;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #ff4b8a, #ff7a5c);
      color: #fff;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    .hm-btn-primary:active {
      transform: scale(0.98);
    }
    .hm-btn-secondary {
      width: 100%;
      padding: 10px 0;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      color: #374151;
      font-size: 15px;
      cursor: pointer;
      margin-top: 8px;
    }
    .hm-btn-secondary span {
      margin-left: 6px;
    }
    .hm-privacy-text {
      margin-top: 8px;
      font-size: 11px;
      color: #999;
      text-align: center;
    }

    /* ================== æˆ‘çš„è³‡æ–™å¡ç‰‡ ================== */
    #hm-profile-section {
      padding: 16px;
      box-sizing: border-box;
    }
    .hm-profile-card {
      background: rgba(255, 255, 255, 0.96);
      border-radius: 18px;
      padding: 14px 16px 12px 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    .hm-profile-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .hm-profile-avatar {
      width: 52px;
      height: 52px;
      border-radius: 50%;
      background: linear-gradient(135deg, #ff4b8a, #ff7a5c);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 18px;
      flex-shrink: 0;
    }
    .hm-profile-avatar span {
      user-select: none;
    }
    .hm-profile-basic h3 {
      margin: 0 0 4px 0;
      font-size: 17px;
    }
    .hm-profile-basic p {
      margin: 0;
      font-size: 13px;
      color: #666;
    }
    .hm-profile-region {
      margin-top: 2px;
    }
    .hm-profile-bind {
      margin-top: 2px;
      font-size: 11px;
      color: #9ca3af;
    }
    .hm-profile-social-block {
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid #f0f0f0;
    }
    .hm-profile-social-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }
    .hm-profile-social-title {
      font-size: 14px;
      font-weight: 600;
    }
    .hm-profile-social-sub {
      font-size: 11px;
      color: #999;
    }
    .hm-profile-social-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .hm-profile-social-empty {
      font-size: 12px;
      color: #aaa;
    }
    .hm-social-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      text-decoration: none;
      border: 1px solid #eee;
      background: #fafafa;
      color: #444;
      cursor: pointer;
    }
    .hm-social-chip:hover {
      background: #fff2f7;
    }
    .hm-social-icon {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 600;
    }
    .hm-social-threads .hm-social-icon {
      background: #000;
      color: #fff;
    }
    .hm-social-x .hm-social-icon {
      background: #000;
      color: #fff;
    }
    .hm-social-instagram .hm-social-icon {
      background: #ff5f6d;
      color: #fff;
    }
    .hm-social-facebook .hm-social-icon {
      background: #1877f2;
      color: #fff;
    }
    .hm-social-other .hm-social-icon {
      background: #7b61ff;
      color: #fff;
    }
    .hm-profile-footer {
      margin-top: 12px;
      text-align: right;
    }
    .hm-btn-outline {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 12px;
      border: 1px solid #ff7a5c;
      background: #fff;
      color: #ff7a5c;
      cursor: pointer;
    }
    .hm-btn-outline:active {
      transform: scale(0.97);
    }

    /* VIP ç­‰ç´šæ¨™ç±¤ï¼ˆæ”¾åœ¨é ­åƒæ—é‚Šç”¨ï¼‰ */
    .vip-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 6px;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #111827;
      font-weight: 700;
    }

    /* æˆ‘çš„ 6 å¼µç…§ç‰‡å€å¡Š */
    .my-album-note {
      font-size: 13px;
      color: #6b7280;
      padding: 6px 16px 0;
    }
    .my-album-grid {
      padding: 12px 16px 12px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .my-album-item {
      position: relative;
      width: 100%;
      padding-top: 100%;
      border-radius: 14px;
      overflow: hidden;
      background: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }
    .my-album-item img {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .my-album-slot-label {
      position: absolute;
      bottom: 4px;
      left: 4px;
      right: 4px;
      font-size: 11px;
      color: #f9fafb;
      text-shadow: 0 1px 3px rgba(0,0,0,0.6);
    }
    .my-album-upload-btn {
      position: absolute;
      top: 6px;
      right: 6px;
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: none;
      background: rgba(31,41,55,0.9);
      color: #f9fafb;
      cursor: pointer;
    }
    .my-album-lock-overlay {
      position: absolute;
      inset: 0;
      background: rgba(15,23,42,0.82);
      color: #f9fafb;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      text-align: center;
      padding: 6px;
    }
    .my-album-lock-btn {
      margin-top: 6px;
      padding: 4px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: none;
      background: #f97316;
      color: #ffffff;
      cursor: pointer;
    }
    .my-album-vip-demo {
      padding: 0 16px 10px;
      font-size: 12px;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .my-album-vip-demo button {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      cursor: pointer;
    }

    /* å¥½å‹ tab ç´…é» */
    .friend-tab-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 16px;
      padding: 0 6px;
      margin-left: 4px;
      font-size: 11px;
      border-radius: 999px;
      background: #ef4444;
      color: #fff;
    }
  </style>
</head>
<body>
 <!-- é ‚éƒ¨ -->
 <div class="top-bar">
   <div class="top-bar-inner">
     <div class="top-title" id="topTitle">äººå€‘ Â· å¿ƒé‡ XinYou</div>
     <div class="top-right" id="topRightSlot"></div>
   </div>
 </div>

 <!-- äººå€‘é  -->
 <div class="page active" id="page-people">
   <div class="people-wrapper">
     <div class="people-grid" id="peopleGrid"></div>
     <div class="pager">
       <button class="pager-btn" id="nextBatchBtn">æ›ä¸€æ‰¹çœ‹çœ‹ âœ</button>
     </div>
   </div>
 </div>

 <!-- è©³ç´°æª”æ¡ˆé  -->
 <div class="page" id="page-profileDetail">
   <div id="profileDetailContent"></div>
 </div>

 <!-- å¥½å‹é  -->
 <div class="page" id="page-friends">
   <div class="tabs-row">
     <div class="tab-btn active" data-friendtab="friends">å¥½å‹</div>
     <div class="tab-btn" data-friendtab="sent">é€å‡ºç”³è«‹</div>
     <div class="tab-btn" data-friendtab="received">æ”¶åˆ°ç”³è«‹</div>
   </div>
   <ul class="list" id="friendsList"></ul>
 </div>

 <!-- æ’è¡Œæ¦œé  -->
 <div class="page" id="page-rank">
   <div class="rank-tabs">
     <div class="rank-tab active" data-ranktab="pop">äººæ°£æ¦œ</div>
     <div class="rank-tab" data-ranktab="receive">æ”¶ç¦®æ¦œ</div>
     <div class="rank-tab" data-ranktab="send">é€ç¦®æ¦œ</div>
   </div>
   <div class="rank-wrapper">
     <div class="card rank-pyramid-card" id="rankPyramid"></div>
     <div class="rank-list" id="rankList"></div>
     <div class="rank-note">
       æ’è¡Œæ¦œç›®å‰ç‚ºç¤ºæ„ç‰ˆã€‚æ­£å¼ç‰ˆæœƒä¾ç…§èŠå¤©é‡ã€ç¦®ç‰©ã€äº’å‹•åˆ†æ•¸è¨ˆç®—ã€‚<br />
       No.1 å¯è‡ªç”±é¸æ“‡é¡¯ç¤ºã€ŒKingã€æˆ–ã€ŒQueenã€ã€‚
     </div>
   </div>
 </div>

 <!-- èŠå¤©é  -->
 <div class="page" id="page-chat">
   <div class="chat-theme-bar">
     <div class="chat-theme-pill active" data-theme="light">æ·ºè‰²</div>
     <div class="chat-theme-pill" data-theme="pink">æ·¡ç²‰</div>
     <div class="chat-theme-pill" data-theme="blue">æ·¡è—</div>
     <div class="chat-theme-pill" data-theme="dark">æ·±è‰²</div>
   </div>
   <div class="chat-wrapper chat-theme-light" id="chatWrapper">
     <div class="chat-messages" id="chatMessages">
       <div class="bubble-row">
         <div class="bubble them">
           æ­¡è¿ä¾†åˆ°ã€Œå¿ƒé‡ XinYouã€èŠå¤©ä»‹é¢ç¤ºæ„ã€‚<br />
           ç›®å‰æ˜¯å‰ç«¯åŸå‹ï¼Œæœªé€£æ¥çœŸå¯¦å¾Œç«¯ã€‚
         </div>
       </div>
       <div class="bubble-row me">
         <div class="bubble me">
           è€é—†ä½ å¯ä»¥åˆ‡æ›ä¸Šæ–¹èŠå¤©èƒŒæ™¯ã€è©¦è©¦è¼¸å…¥æ–‡å­—ã€ç”¨ä¸‹é¢çš„ + è™Ÿæ‰“é–‹è²¼åœ– / ç…§ç‰‡ / GIFã€‚
         </div>
       </div>
     </div>
     <div class="chat-input-area">
       <div class="chat-more-menu" id="chatMoreMenu">
         <button class="chat-more-btn" data-type="sticker">ğŸ˜Š è²¼åœ–</button>
         <button class="chat-more-btn" id="chatPhotoBtn">ğŸ–¼ ç…§ç‰‡</button>
         <button class="chat-more-btn" id="chatGifBtn">GIF å‹•åœ–</button>
       </div>
       <div class="chat-sticker-bar" id="stickerBar">
         <button class="sticker-btn">ğŸ˜Š</button>
         <button class="sticker-btn">ğŸ˜‚</button>
         <button class="sticker-btn">ğŸ¥º</button>
         <button class="sticker-btn">â¤ï¸</button>
         <button class="sticker-btn">ğŸ‘</button>
         <button class="sticker-btn">ğŸ”¥</button>
       </div>
       <div class="chat-input-bar">
         <button class="chat-plus-btn" id="chatPlusBtn">ï¼‹</button>
         <input class="chat-input" id="chatInput" placeholder="è¼¸å…¥è¨Šæ¯..." />
         <button class="chat-send-btn" id="chatSendBtn">å‚³é€</button>
       </div>
       <input type="file" id="chatPhotoInput" accept="image/*" style="display:none" />
       <input type="file" id="chatGifInput" accept="image/gif,image/*,video/*" style="display:none" />
     </div>
   </div>
 </div>

 <!-- æˆ‘çš„é  -->
 <div class="page" id="page-me">
   <div class="profile-header">
     <div class="profile-row-main">
       <div class="profile-avatar">
         <img src="https://picsum.photos/200/200?random=99" alt="æˆ‘çš„é ­åƒ" />
       </div>
       <div>
         <div class="profile-name">
           æˆ‘è‡ªå·± Â· Demo
           <span id="myVipBadge" class="vip-badge" style="display:none;"></span>
         </div>
         <div class="profile-sub" id="myProfileSub">å°ç£ Â· 30 æ­²å·¦å³ Â· å·²ä¸Šç·š</div>
       </div>
     </div>
   </div>

   <!-- HeartMeet æˆ‘çš„è³‡æ–™å¡ç‰‡ï¼ˆé€£å‹•å½ˆè·³è¦–çª—è³‡æ–™ï¼‰ -->
   <section id="hm-profile-section">
     <div class="hm-profile-card">
       <div class="hm-profile-header">
         <div class="hm-profile-avatar">
           <span id="hm-profile-avatar-text">Me</span>
         </div>
         <div class="hm-profile-basic">
           <h3 id="hm-profile-name">æœªè¨­å®šå§“å</h3>
           <p id="hm-profile-meta">èº«é«˜ / é«”é‡ æœªå¡«å¯«</p>
           <p id="hm-profile-region" class="hm-profile-region">å±…ä½å€åŸŸï¼šæœªå¡«å¯«</p>
           <p id="hm-profile-bind" class="hm-profile-bind">å°šæœªç¶å®šå¸³è™Ÿ</p>
         </div>
       </div>

       <div class="hm-profile-social-block">
         <div class="hm-profile-social-title-row">
           <span class="hm-profile-social-title">ç¤¾ç¾¤ä¸²è¯</span>
           <span class="hm-profile-social-sub">å¤šå¹³å°é€£çµï¼Œå¢åŠ çœŸå¯¦æ„Ÿ</span>
         </div>
         <div id="hm-profile-social-list" class="hm-profile-social-list">
           <span class="hm-profile-social-empty">ç›®å‰å°šæœªä¸²è¯ä»»ä½•ç¤¾ç¾¤å¸³è™Ÿ</span>
         </div>
       </div>

       <div class="hm-profile-footer">
         <button id="hm-profile-edit-btn" class="hm-btn-outline">
           ç·¨è¼¯åŸºæœ¬è³‡æ–™ / ç¤¾ç¾¤ä¸²è¯
         </button>
       </div>
     </div>
   </section>

   <!-- æˆ‘çš„ 6 å¼µç…§ç‰‡å€ -->
   <div class="section">
     <div class="section-title">æˆ‘çš„ç…§ç‰‡ï¼ˆæœ€å¤š 6 å¼µï¼Œç¤ºæ„ï¼‰</div>
     <div class="my-album-note">
       å‰ 2 å¼µç‚ºå…è²»é è¦½ï¼Œå¾Œ 4 å¼µéœ€è§€çœ‹ä¸€æ¬¡å»£å‘Šæš«æ™‚è§£é–ï¼›æˆç‚º VIP1ï½VIP5 å¾Œï¼Œ6 å¼µå°‡å…¨éƒ¨æ°¸ä¹…é–‹æ”¾ï¼ˆDemo æ¨¡å¼ç”¨æŒ‰éˆ•åˆ‡æ› VIP ç­‰ç´šï¼‰ã€‚
     </div>
     <div id="myAlbumGrid" class="my-album-grid"></div>
     <div class="my-album-vip-demo">
       <span id="vipLevelText">ç›®å‰ VIP ç­‰ç´šï¼šç„¡ï¼ˆDemoï¼‰</span>
       <button id="vipLevelToggleBtn" type="button">åˆ‡æ› VIP ç­‰ç´šï¼ˆ0â†’5 å¾ªç’°ï¼‰</button>
     </div>
   </div>

   <div class="section">
     <div class="section-title">æˆ‘çš„ç‹€æ…‹ï¼ˆåƒä»¥å‰å³æ™‚é€šé‚£æ¨£ï¼‰</div>
     <div class="diary-list">
       <div class="diary-item">
         <div style="margin-bottom:6px;">
           <span style="font-size:16px; color:#374151;">ç›®å‰ç‹€æ…‹ï¼š</span>
           <span id="myStatusBadge" class="status-badge">
             <span class="status-dot"></span><span id="myStatusText">å·²ä¸Šç·š</span>
           </span>
         </div>
         <div style="margin-top:4px; font-size:16px;">
           <label for="statusSelect">ä¿®æ”¹ç‹€æ…‹ï¼š</label>
           <select id="statusSelect">
             <option value="online">å·²ä¸Šç·š</option>
             <option value="busy">å¿™ç¢Œä¸­â€¦</option>
             <option value="eating">ç”¨é¤å»â€¦</option>
             <option value="shower">æ´—æ¾¡ä¸­â€¦</option>
             <option value="away">æš«é›¢ä¸­â€¦</option>
             <option value="offline">é›¢ç·šä¸­</option>
             <option value="chatty">æƒ³èŠå¤©</option>
           </select>
         </div>
         <div class="my-section-note">
           æ­£å¼ç‰ˆæœƒæŠŠé€™å€‹ç‹€æ…‹åŒæ­¥é¡¯ç¤ºåœ¨ã€Œäººå€‘ã€èˆ‡ã€Œå¥½å‹ã€åˆ—è¡¨ã€‚
         </div>
       </div>
     </div>
   </div>

   <div class="section">
     <div class="section-title">å¥½å‹é™å®šçš„å°èªï¼ˆåªæœ‰å¥½å‹çœ‹å¾—åˆ°ï¼‰</div>
     <div class="diary-list">
       <div class="diary-item">
         <div style="font-size:16px; margin-bottom:4px;">
           åœ¨é€™è£¡å¯«ä¸€äº›æ¯”è¼ƒç§äººçš„å¿ƒæƒ…ï¼Œåªè®“å¥½å‹çœ‹å¾—åˆ°ã€‚
         </div>
         <textarea id="friendNoteInput">ä»Šå¤©å¥½é›£éï¼Œå¸Œæœ›èƒ½æœ‰å¥½å¤©æ°£å‡ºç¾ã€‚</textarea>
         <div style="margin-top:8px; font-size:14px; color:#9ca3af;">
           å¥½å‹åˆ—è¡¨é¡¯ç¤ºé è¦½ï¼š
         </div>
         <div id="friendNotePreview" class="item-row3" style="margin-top:4px;">
           <span class="label">å¥½å‹é™å®šï¼š</span>ä»Šå¤©å¥½é›£éï¼Œå¸Œæœ›èƒ½æœ‰å¥½å¤©æ°£å‡ºç¾ã€‚
         </div>
       </div>
     </div>
   </div>

   <div class="section">
     <div class="section-title">èª°ä¾†çœ‹éæˆ‘ï¼ˆæœ€è¿‘è¶³è·¡ç¤ºæ„ï¼‰</div>
     <div class="footprint-list">
       <div class="footprint-item">
         <div class="footprint-avatar">
           <img src="https://picsum.photos/200/200?random=301" alt="footprint1">
         </div>
         <div class="footprint-main">
           <div class="footprint-name">å°èŒµ</div>
           <div class="footprint-sub">ä¾†è‡ª å°åŒ— Â· 2 å°æ™‚å‰ä¾†çœ‹éä½ </div>
         </div>
       </div>
       <div class="footprint-item">
         <div class="footprint-avatar">
           <img src="https://picsum.photos/200/200?random=302" alt="footprint2">
         </div>
         <div class="footprint-main">
           <div class="footprint-name">Ken</div>
           <div class="footprint-sub">ä¾†è‡ª é«˜é›„ Â· æ˜¨å¤©æ™šä¸Šè·¯éä½ çš„æª”æ¡ˆ</div>
         </div>
       </div>
       <div class="footprint-item">
         <div class="footprint-avatar">
           <img src="https://picsum.photos/200/200?random=303" alt="footprint3">
         </div>
         <div class="footprint-main">
           <div class="footprint-name">Rin</div>
           <div class="footprint-sub">ä¾†è‡ª æ–°åŒ— Â· 3 å¤©å‰æ‹œè¨ª</div>
         </div>
       </div>
       <div class="my-section-note">
         æ­£å¼ç‰ˆå¯ä»¥æŠŠé€™è£¡åšæˆ VIP æ‰èƒ½çœ‹å®Œæ•´åå–®ï¼æ™‚é–“çš„åŠŸèƒ½ã€‚
       </div>
     </div>
   </div>

   <div class="section">
     <div class="section-title">æœå°‹èˆ‡é€šçŸ¥è¨­å®šï¼ˆç¤ºæ„ï¼‰</div>
     <div class="form-list">
       <div class="form-row">
         <div class="form-label">åœ‹å®¶ / åœ°å€</div>
         <div class="form-value">å°ç£ Â· å…¨éƒ¨åœ°å€ &gt;</div>
       </div>
       <div class="form-row">
         <div class="form-label">æ¥å—å¥½å‹ç”³è«‹</div>
         <div class="toggle on"><div class="toggle-knob"></div></div>
       </div>
       <div class="form-row">
         <div class="form-label">èŠå¤©é€šçŸ¥</div>
         <div class="toggle on"><div class="toggle-knob"></div></div>
       </div>
     </div>
     <div class="my-section-note">
       é€™è£¡ä¹‹å¾Œå¯ä»¥é€£åˆ°çœŸæ­£çš„è¨­å®šé ï¼Œè®“ç”¨æˆ¶ç´°èª¿é€šçŸ¥ã€æœå°‹æ¢ä»¶ç­‰ã€‚
     </div>
   </div>

   <div class="section">
     <div class="section-title">æˆ‘çš„æ—¥è¨˜ï¼ˆç¤ºæ„ï¼Œä¹‹å¾Œå¯é™åˆ¶å…è²» 5 ç¯‡ï¼‰</div>
     <div class="diary-list">
       <div class="diary-item">
         <div class="diary-date">2025-12-05</div>
         <div>ä»Šå¤©çœ‹äº†ã€Œå¿ƒé‡ XinYouã€V3 åŸå‹ï¼Œæ„Ÿè¦ºå·²ç¶“æœ‰æ­£å¼äº¤å‹ App é››å½¢ã€‚</div>
       </div>
       <div class="diary-item">
         <div class="diary-date">2025-11-30</div>
         <div>æœªä¾†å¯èƒ½æœƒåŠ å…¥ç°½åˆ°ã€é€èŠ±ã€æ’è¡Œæ¦œç©åˆ†ï¼Œå…ˆå°ˆå¿ƒæŠŠåŸºç¤åšå¥½ã€‚</div>
       </div>
     </div>
   </div>

   <!-- å¸³è™Ÿèˆ‡å®‰å…¨ï¼šå·²ç§»åˆ°æœ€åº•éƒ¨ -->
   <div class="section">
     <div class="section-title">å¸³è™Ÿèˆ‡å®‰å…¨</div>
     <div class="diary-list">
       <div class="diary-item">
         <div style="font-size:16px; margin-bottom:6px;">
           è‹¥ä½ æ˜¯åœ¨ä»–äººè£ç½®ä¸Šä½¿ç”¨ï¼Œå»ºè­°é›¢é–‹å‰å…ˆç™»å‡ºï¼Œä»¥å…å€‹äººè³‡æ–™è¢«ä»–äººæŸ¥çœ‹ã€‚
         </div>
         <button id="hm-logout-btn" type="button" class="hm-btn-outline">
           ç™»å‡ºç›®å‰å¸³è™Ÿï¼ˆæ¸…é™¤æœ¬æ©Ÿæš«å­˜è³‡æ–™ï¼‰
         </button>
         <div style="margin-top:8px; font-size:13px; color:#9ca3af;">
           Demoï¼šç™»å‡ºæœƒæ¸…é™¤æœ¬æ©Ÿçš„ç¶å®šè³‡è¨Šã€åŸºæœ¬è³‡æ–™èˆ‡ç›¸ç°¿æš«å­˜ï¼Œä¸‹æ¬¡é€²å…¥æ™‚æœƒé‡æ–°è·³å‡ºç¶å®šèˆ‡å¡«å¯«è³‡æ–™çš„è¦–çª—ã€‚
         </div>
       </div>
     </div>
   </div>
 </div>

 <!-- åº•éƒ¨å°èˆª -->
 <div class="bottom-nav">
   <div class="nav-item active" data-page="people">
     <div class="nav-item-inner">
       <div class="nav-icon">äºº</div>
       <span>å·§é‡</span>
     </div>
   </div>
   <div class="nav-item" data-page="friends">
     <div class="nav-item-inner">
       <div class="nav-icon">å‹</div>
       <span>å¥½å‹</span>
     </div>
   </div>
   <div class="nav-item" data-page="rank">
     <div class="nav-item-inner">
       <div class="nav-icon">å† </div>
       <span>æ’è¡Œæ¦œ</span>
     </div>
   </div>
   <div class="nav-item" data-page="chat">
     <div class="nav-item-inner">
       <div class="nav-icon">èŠ</div>
       <span>èŠå¤©</span>
     </div>
   </div>
   <div class="nav-item" data-page="me">
     <div class="nav-item-inner">
       <div class="nav-icon">æˆ‘</div>
       <span>æˆ‘çš„</span>
     </div>
   </div>
 </div>

 <!-- å…¨è¢å¹• Viewer -->
 <div class="photo-viewer" id="photoViewer">
   <img src="" alt="photo">
   <div class="photo-viewer-close" onclick="closeViewer()">âœ•</div>
 </div>

 <!-- ç™»å…¥ç¶å®š Modal -->
 <div id="hm-login-modal" class="hm-modal-backdrop">
   <div class="hm-modal">
     <div class="hm-modal-header">
       <h2>é¸æ“‡ç™»å…¥æ–¹å¼ Â· ç¶å®šå¸³è™Ÿ</h2>
       <p>å…ˆç¶å®šä¸€å€‹å¸¸ç”¨çš„ç³»çµ±å¸³è™Ÿï¼Œä¹‹å¾Œå„²å€¼èˆ‡ä»£å¹£éƒ½æœƒè·Ÿé€™å€‹å¸³è™Ÿä¸€èµ·èµ°ã€‚</p>
     </div>
     <div>
       <button id="hm-login-google" class="hm-btn-primary">
         ä»¥ Google å¸³è™Ÿç™»å…¥
       </button>
       <button id="hm-login-facebook" class="hm-btn-secondary">
         <span>ä»¥ Facebook å¸³è™Ÿç™»å…¥</span>
       </button>
       <button id="hm-login-apple" class="hm-btn-secondary">
         <span>ä»¥ Apple å¸³è™Ÿç™»å…¥</span>
       </button>
     </div>
     <p class="hm-privacy-text">
       â€» Demo ç‰ˆæœ¬ä¸æœƒçœŸçš„é€£åˆ° Google / Facebook / Appleï¼Œåƒ…æ¨¡æ“¬ç¶å®šæµç¨‹ã€‚
     </p>
   </div>
 </div>

 <!-- åŸºæœ¬è³‡æ–™å½ˆè·³è¦–çª—ï¼šHeartMeet Profile Modal -->
 <div id="hm-profile-modal" class="hm-modal-backdrop">
   <div class="hm-modal">
     <div class="hm-modal-header">
       <h2>å®ŒæˆåŸºæœ¬è³‡æ–™ï¼Œé–‹å§‹é…å°</h2>
       <p>ç‚ºäº†æå‡çœŸå¯¦åº¦èˆ‡é…å°å“è³ªï¼Œè«‹å…ˆå¡«å¯«ä»¥ä¸‹è³‡è¨Šã€‚</p>
     </div>

     <form id="hm-profile-form">
       <div class="hm-form-group">
         <label for="hm-name">* <span class="hm-required">*</span>ç¨±å‘¼ï¼ˆæš±ç¨±ï¼‰</label>
         <input type="text" id="hm-name" name="name" placeholder="çµ¦è‡ªå·±ä¸€å€‹å¥½è¨˜çš„ç¨±å‘¼" required />
       </div>

       <div class="hm-form-group hm-inline">
         <div>
           <label for="hm-height">* <span class="hm-required">*</span>èº«é«˜ (cm)</label>
           <input type="number" id="hm-height" name="height" min="120" max="230" placeholder="ä¾‹å¦‚ï¼š172" required />
         </div>
         <div>
           <label for="hm-weight">* <span class="hm-required">*</span>é«”é‡ (kg)</label>
           <input type="number" id="hm-weight" name="weight" min="35" max="200" placeholder="ä¾‹å¦‚ï¼š65" required />
         </div>
       </div>

       <div class="hm-form-group">
         <label for="hm-region">å±…ä½å€åŸŸï¼ˆå¯ç¨å¾Œå†å¡«ï¼‰</label>
         <input
           type="text"
           id="hm-region"
           name="region"
           placeholder="ä¾‹å¦‚ï¼šå°åŒ—å¸‚ ä¿¡ç¾©å€ / èŠ±è“®ç¸£ ç‘ç©—é„‰"
         />
       </div>

       <div class="hm-form-group">
         <label>ç¤¾ç¾¤å¸³è™Ÿä¸²è¯ï¼ˆå¯é¸å¡«ï¼Œå¢åŠ ä¿¡ä»»æ„Ÿï¼‰</label>
         <p class="hm-help-text">
           Threads / X / IG / FB çš†å¯å…ˆç•¥éï¼Œä¹‹å¾Œä¹Ÿå¯ä»¥åœ¨ã€Œæˆ‘çš„è³‡æ–™ã€ä¸­å†è£œä¸Šæˆ–ä¿®æ”¹ã€‚
         </p>

         <div class="hm-social-row">
           <span class="hm-social-label">Threads</span>
           <input
             type="text"
             id="hm-threads"
             name="threads"
             placeholder="è²¼ä¸Š Threads å€‹äººé é€£çµæˆ–å¸³è™Ÿï¼ˆé¸å¡«ï¼‰"
           />
         </div>

         <div class="hm-social-row">
           <span class="hm-social-label">X (Twitter)</span>
           <input
             type="text"
             id="hm-x"
             name="x"
             placeholder="è²¼ä¸Š X å€‹äººé é€£çµæˆ–å¸³è™Ÿï¼ˆé¸å¡«ï¼‰"
           />
         </div>

         <div class="hm-social-row">
           <span class="hm-social-label">Instagram</span>
           <input
             type="text"
             id="hm-instagram"
             name="instagram"
             placeholder="è²¼ä¸Š IG å€‹äººé é€£çµæˆ–å¸³è™Ÿï¼ˆé¸å¡«ï¼‰"
           />
         </div>

         <div class="hm-social-row">
           <span class="hm-social-label">Facebook</span>
           <input
             type="text"
             id="hm-facebook"
             name="facebook"
             placeholder="è²¼ä¸Š FB å€‹äººé é€£çµæˆ–å¸³è™Ÿï¼ˆé¸å¡«ï¼‰"
           />
         </div>

         <div class="hm-social-row">
           <span class="hm-social-label">å…¶ä»–</span>
           <input
             type="text"
             id="hm-other"
             name="other"
             placeholder="ä¾‹å¦‚ï¼šLINE ID / å®˜æ–¹ç¶²ç«™ / YouTube é »é“ï¼ˆé¸å¡«ï¼‰"
           />
         </div>
       </div>

       <div class="hm-form-group hm-checkbox-group">
         <label>
           <input type="checkbox" id="hm-agree" required />
           æˆ‘å·²é–±è®€ä¸¦åŒæ„ HeartMeet çš„æœå‹™æ¢æ¬¾èˆ‡éš±ç§æ”¿ç­–
         </label>
       </div>

       <div class="hm-modal-footer">
         <button type="submit" class="hm-btn-primary">å®Œæˆä¸¦é–‹å§‹ä½¿ç”¨</button>
       </div>

       <p class="hm-privacy-text">
         â€» éƒ¨åˆ†è³‡æ–™åªç”¨æ–¼ç³»çµ±é…å°èˆ‡å¯¦åæ„Ÿé©—è­‰ï¼Œä¸æœƒå…¬é–‹é¡¯ç¤ºæ‚¨çš„çœŸå¯¦å§“åã€‚
       </p>
     </form>
   </div>
 </div>

 <script>
  // ==== å‡è³‡æ–™ï¼šäººå€‘ ====
  const people = [
    {
      id: 1,
      name: "ã‚Šã‚“ã‚Šã‚“",
      ageText: "20 æ­²å¾ŒåŠ",
      desc: "æ—¥èªã€ä¸­åœ‹èªå¯â˜…",
      avatar: "https://picsum.photos/300/400?random=1",
      status: "online",
      statusText: "å·²ä¸Šç·š",
      vipLevel: 3,
      album: [
        "https://picsum.photos/400/400?random=101",
        "https://picsum.photos/400/400?random=102",
        "https://picsum.photos/400/400?random=103",
        "https://picsum.photos/400/400?random=104",
        "https://picsum.photos/400/400?random=105",
        "https://picsum.photos/400/400?random=106"
      ]
    },
    {
      id: 2,
      name: "Meow",
      ageText: "30 æ­²åˆåŠ",
      desc: "å…§æœ‰æƒ¡è²“ã€‚",
      avatar: "https://picsum.photos/300/400?random=2",
      status: "eating",
      statusText: "ç”¨é¤å»â€¦",
      vipLevel: 5,
      album: [
        "https://picsum.photos/400/400?random=201",
        "https://picsum.photos/400/400?random=202",
        "https://picsum.photos/400/400?random=203",
        "https://picsum.photos/400/400?random=204",
        "https://picsum.photos/400/400?random=205",
        "https://picsum.photos/400/400?random=206"
      ]
    },
    {
      id: 3,
      name: "Min",
      ageText: "10 æ­²å¾ŒåŠ",
      desc: "é™¤äº†ç™¼å‘†é‚„æ˜¯ç™¼å‘†ç›´åˆ°è®Šå‘†ã€‚",
      avatar: "httpsum.photos/300/400?random=3".replace("httpsum","https://pics"),
      status: "away",
      statusText: "æš«é›¢ä¸­â€¦",
      vipLevel: 1,
      album: [
        "https://picsum.photos/400/400?random=301",
        "https://picsum.photos/400/400?random=302",
        "https://picsum.photos/400/400?random=303",
        "https://picsum.photos/400/400?random=304",
        "https://picsum.photos/400/400?random=305",
        "https://picsum.photos/400/400?random=306"
      ]
    },
    {
      id: 4,
      name: "å½±å¯’",
      ageText: "30 æ­²åˆåŠ",
      desc: "å€šæ¬„è½é¢¨é›¨ï¼Œæ·¡çœ‹æ±Ÿæ¹–è·¯ã€‚",
      avatar: "https://picsum.photos/300/400?random=4",
      status: "online",
      statusText: "æƒ³èŠå¤©",
      vipLevel: 2,
      album: [
        "https://picsum.photos/400/400?random=401",
        "https://picsum.photos/400/400?random=402",
        "https://picsum.photos/400/400?random=403",
        "https://picsum.photos/400/400?random=404",
        "https://picsum.photos/400/400?random=405",
        "https://picsum.photos/400/400?random=406"
      ]
    },
    {
      id: 5,
      name: "é˜¿åˆ",
      ageText: "20 æ­²åˆåŠ",
      desc: "å–œæ­¡éœ²ç‡Ÿã€æ‹ç…§ã€çœ‹æ˜Ÿæ˜Ÿã€‚",
      avatar: "https://picsum.photos/300/400?random=5",
      status: "busy",
      statusText: "å¿™ç¢Œä¸­â€¦",
      vipLevel: 4,
      album: [
        "https://picsum.photos/400/400?random=501",
        "https://picsum.photos/400/400?random=502",
        "https://picsum.photos/400/400?random=503",
        "https://picsum.photos/400/400?random=504",
        "https://picsum.photos/400/400?random=505",
        "https://picsum.photos/400/400?random=506"
      ]
    },
    {
      id: 6,
      name: "å°è·¯",
      ageText: "30 æ­²å¾ŒåŠ",
      desc: "èµ°åœ¨è·¯ä¸Šéš¨ä¾¿äº‚æƒ³äº‹æƒ…ã€‚",
      avatar: "https://picsum.photos/300/400?random=6",
      status: "shower",
      statusText: "æ´—æ¾¡ä¸­â€¦",
      vipLevel: 1,
      album: [
        "https://picsum.photos/400/400?random=601",
        "https://picsum.photos/400/400?random=602",
        "https://picsum.photos/400/400?random=603",
        "https://picsum.photos/400/400?random=604",
        "https://picsum.photos/400/400?random=605",
        "https://picsum.photos/400/400?random=606"
      ]
    },
    {
      id: 7,
      name: "Kimi",
      ageText: "20 æ­²åˆåŠ",
      desc: "å–œæ­¡åˆ°è™•åƒåƒå–å–ã€‚",
      avatar: "https://picsum.photos/300/400?random=7",
      status: "online",
      statusText: "å·²ä¸Šç·š",
      vipLevel: 2,
      album: [
        "https://picsum.photos/400/400?random=701",
        "https://picsum.photos/400/400?random=702",
        "https://picsum.photos/400/400?random=703",
        "https://picsum.photos/400/400?random=704",
        "https://picsum.photos/400/400?random=705",
        "https://picsum.photos/400/400?random=706"
      ]
    },
    {
      id: 8,
      name: "Mori",
      ageText: "40 æ­²å‰å¾Œ",
      desc: "ç†Ÿé½¡äº¤å‹ï¼Œæ…¢æ…¢èŠã€‚",
      avatar: "https://picsum.photos/300/400?random=8",
      status: "away",
      statusText: "é›¢ç·šä¸­",
      vipLevel: 0,
      album: [
        "https://picsum.photos/400/400?random=801",
        "https://picsum.photos/400/400?random=802",
        "https://picsum.photos/400/400?random=803",
        "https://picsum.photos/400/400?random=804",
        "https://picsum.photos/400/400?random=805",
        "https://picsum.photos/400/400?random=806"
      ]
    }
  ];

  // é è¨­ç›¸ç°¿ç…§ç‰‡ï¼ˆç•¶ä½¿ç”¨è€…å°šæœªè‡ªå·±ä¸Šå‚³æ™‚ï¼Œç•¶ä½œåº•åœ–ï¼‰
  const albumPhotos = [
    "https://picsum.photos/400/400?random=901",
    "https://picsum.photos/400/400?random=902",
    "https://picsum.photos/400/400?random=903",
    "https://picsum.photos/400/400?random=904",
    "https://picsum.photos/400/400?random=905",
    "https://picsum.photos/400/400?random=906"
  ];

  const peopleGridEl = document.getElementById("peopleGrid");
  const nextBatchBtn = document.getElementById("nextBatchBtn");
  const profileDetailContent = document.getElementById("profileDetailContent");
  const topTitleEl = document.getElementById("topTitle");
  const topRightSlot = document.getElementById("topRightSlot");

  let currentBatch = [];
  let currentProfileId = null; // ç›®å‰æ­£åœ¨æŸ¥çœ‹çš„æª”æ¡ˆ idï¼ˆçµ¦ç›¸ç°¿è§£é–å¾Œé‡åˆ·ç”¨ï¼‰

  function shuffleArray(arr) {
    const copy = arr.slice();
    for (let i = copy.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [copy[i], copy[j]] = [copy[j], copy[i]];
    }
    return copy;
  }

  function pickRandomBatch() {
    const shuffled = shuffleArray(people);
    currentBatch = shuffled.slice(0, 4);
  }

  function renderPeopleGrid() {
    if (currentBatch.length === 0) pickRandomBatch();
    peopleGridEl.innerHTML = "";
    currentBatch.forEach(p => {
      const card = document.createElement("div");
      card.className = "people-card";
      card.onclick = () => openProfileDetail(p.id);

      const photo = document.createElement("div");
      photo.className = "people-photo";
      photo.innerHTML = '<img src="' + p.avatar + '" alt="' + p.name + '" />';

      const info = document.createElement("div");
      info.className = "people-info";

      const row1 = document.createElement("div");
      row1.className = "people-name-row";

      const nameEl = document.createElement("div");
      nameEl.className = "people-name";
      nameEl.textContent = p.name;

      const ageEl = document.createElement("div");
      ageEl.className = "people-age";
      ageEl.textContent = p.ageText;

      row1.appendChild(nameEl);
      row1.appendChild(ageEl);

      let statusClass = "status-badge";
      if (p.status === "busy") statusClass += " status-busy";
      if (p.status === "away" || p.status === "offline") statusClass += " status-away";
      if (p.status === "eating") statusClass += " status-eating";
      if (p.status === "shower") statusClass += " status-shower";

      const statusDiv = document.createElement("span");
      statusDiv.className = statusClass;
      statusDiv.innerHTML = '<span class="status-dot"></span><span>' + (p.statusText || "å·²ä¸Šç·š") + '</span>';

      const desc = document.createElement("div");
      desc.className = "people-desc";
      desc.textContent = p.desc;

      info.appendChild(row1);
      info.appendChild(statusDiv);
      info.appendChild(desc);

      card.appendChild(photo);
      card.appendChild(info);

      peopleGridEl.appendChild(card);
    });
  }

  nextBatchBtn.addEventListener("click", () => {
    pickRandomBatch();
    renderPeopleGrid();
  });

  // ===== å¥½å‹ç‹€æ…‹ & é—œä¿‚ =====
  const friendsListEl = document.getElementById("friendsList");

  let friendIds = [1, 2];        // å·²æ˜¯å¥½å‹ï¼ˆç¤ºæ„ï¼‰
  let sentRequestIds = [5];      // ä½ é€å‡ºçš„å¥½å‹ç”³è«‹
  let receivedRequestIds = [7];  // å°ä½ é€å‡ºçš„å¥½å‹ç”³è«‹

  let currentFriendTab = "friends";
  let friendTabFriendsEl = null;
  let friendTabSentEl = null;
  let friendTabReceivedEl = null;

  function getPersonById(id) {
    return people.find(p => p.id === id) || null;
  }

  function hmGetRelation(id) {
    if (friendIds.includes(id)) return "friend";
    if (sentRequestIds.includes(id)) return "sent";
    if (receivedRequestIds.includes(id)) return "received";
    return "none";
  }

  function createTabBadgeHTML(num) {
    if (!num) return "";
    return '<span class="friend-tab-badge">' + num + '</span>';
  }

  function updateFriendTabCounts() {
    if (!friendTabFriendsEl || !friendTabSentEl || !friendTabReceivedEl) return;
    friendTabFriendsEl.innerHTML = "å¥½å‹" + createTabBadgeHTML(friendIds.length);
    friendTabSentEl.innerHTML = "é€å‡ºç”³è«‹" + createTabBadgeHTML(sentRequestIds.length);
    friendTabReceivedEl.innerHTML = "æ”¶åˆ°ç”³è«‹" + createTabBadgeHTML(receivedRequestIds.length);
  }

  // é€å‡ºå¥½å‹ç”³è«‹
  function hmAddFriend(id) {
    const rel = hmGetRelation(id);
    if (rel === "friend") {
      alert("ä½ å€‘å·²ç¶“æ˜¯å¥½å‹å›‰ï¼ï¼ˆDemoï¼‰");
      return;
    }
    if (rel === "sent") {
      alert("å·²é€å‡ºå¥½å‹ç”³è«‹ï¼Œè«‹è€å¿ƒç­‰å€™ã€‚ï¼ˆDemoï¼‰");
      return;
    }
    if (rel === "received") {
      hmAcceptFriend(id);
      return;
    }
    sentRequestIds.push(id);
    sentRequestIds = [...new Set(sentRequestIds)];
    receivedRequestIds = receivedRequestIds.filter(x => x !== id);
    updateFriendTabCounts();
    if (currentFriendTab === "sent") renderFriendsList("sent");
    alert("å·²é€å‡ºå¥½å‹ç”³è«‹ï¼Œè«‹åœ¨ã€Œå¥½å‹ > é€å‡ºç”³è«‹ã€æŸ¥çœ‹ã€‚ï¼ˆDemoï¼‰");
  }

  // åŒæ„å¥½å‹
  function hmAcceptFriend(id) {
    sentRequestIds = sentRequestIds.filter(x => x !== id);
    receivedRequestIds = receivedRequestIds.filter(x => x !== id);
    if (!friendIds.includes(id)) friendIds.push(id);
    updateFriendTabCounts();
    renderFriendsList(currentFriendTab);
    alert("å·²æˆç‚ºå¥½å‹ï¼Œå¯ä»¥é–‹å§‹ 1 å° 1 èŠå¤©ï¼ï¼ˆDemoï¼‰");
  }

  // æ‹’çµ•å¥½å‹
  function hmRejectFriend(id) {
    receivedRequestIds = receivedRequestIds.filter(x => x !== id);
    updateFriendTabCounts();
    renderFriendsList(currentFriendTab);
    alert("å·²æ‹’çµ•æ­¤å¥½å‹ç”³è«‹ã€‚ï¼ˆDemoï¼‰");
  }

  // å–æ¶ˆè‡ªå·±é€å‡ºçš„ç”³è«‹
  function hmCancelFriendRequest(id) {
    sentRequestIds = sentRequestIds.filter(x => x !== id);
    updateFriendTabCounts();
    renderFriendsList(currentFriendTab);
    alert("å·²å–æ¶ˆå¥½å‹ç”³è«‹ã€‚ï¼ˆDemoï¼‰");
  }

  // ===== è©³ç´°æª”æ¡ˆï¼šVIP + å¥½å‹æµç¨‹ =====
  function openProfileDetail(id) {
    const p = people.find(x => x.id === id);
    if (!p) return;
    currentProfileId = id;

    let statusClass = "status-badge";
    if (p.status === "busy") statusClass += " status-busy";
    if (p.status === "away" || p.status === "offline") statusClass += " status-away";
    if (p.status === "eating") statusClass += " status-eating";
    if (p.status === "shower") statusClass += " status-shower";

    const statusBadgeHtml =
      '<span class="' + statusClass + '"><span class="status-dot"></span><span>' +
      (p.statusText || "å·²ä¸Šç·š") + "</span></span>";

    const vipLevel = typeof p.vipLevel === "number" ? p.vipLevel : 0;
    const vipTag = '<span class="vip-badge">VIP' + vipLevel + '</span>';

    const relation = hmGetRelation(p.id);
    let actionHtml = "";

    if (relation === "friend") {
      actionHtml = '<button class="btn btn-primary" onclick="openChatWith(' + p.id + ')">1 å° 1 èŠå¤©</button>';
    } else if (relation === "sent") {
      actionHtml = '<button class="btn" disabled>å·²é€å‡ºå¥½å‹ç”³è«‹</button>';
    } else if (relation === "received") {
      actionHtml = ''
        + '<button class="btn btn-primary btn-sm" onclick="hmAcceptFriend(' + p.id + ')">åŒæ„å¥½å‹ç”³è«‹</button>'
        + '<button class="btn btn-sm" onclick="hmRejectFriend(' + p.id + ')">æ‹’çµ•</button>';
    } else {
      actionHtml = '<button class="btn btn-primary" onclick="hmAddFriend(' + p.id + ')">åŠ å…¥å¥½å‹</button>';
    }

    const totalSlots = (Array.isArray(p.album) && p.album.length > 0)
      ? p.album.length
      : 6;

    const myVipLevel = hmGetVipLevel();
    const unlocked = hmAlbumIsUnlocked();

    const albumHtml = Array.from({ length: totalSlots }).map((_, idx) => {
      const src = hmGetPersonAlbumPhotoSrc(p.id, idx);
      const isFree = idx < 2;
      const isLocked = !isFree && myVipLevel === 0 && !unlocked;
      const lockedClass = isLocked ? " locked" : "";
      return ''
        + '<div class="album-item' + lockedClass + '" onclick="handleStrangerAlbumClick(' + p.id + ',' + idx + ')">'
        + '  <img src="' + src + '" alt="photo' + (idx + 1) + '" />'
        + '  <button class="set-cover-btn" onclick="event.stopPropagation(); setAsAvatar(' + idx + ')">è¨­ç‚ºé ­è²¼</button>'
        + '  <div class="album-gift-btn" onclick="event.stopPropagation(); sendGiftAnimation(this)">ğŸ’ é€ç¦®</div>'
        + '</div>';
    }).join("");

    profileDetailContent.innerHTML = ''
      + '<div class="profile-header">'
      + '  <div class="profile-row-main">'
      + '    <div class="profile-avatar">'
      + '      <img src="' + p.avatar + '" alt="' + p.name + '" />'
      + '    </div>'
      + '    <div>'
      + '      <div class="profile-name">' + p.name + ' ' + vipTag + '</div>'
      + '      <div class="profile-sub">' + p.ageText + ' Â· å°ç£ Â· æš«ç„¡æ›´å¤šä»‹ç´¹</div>'
      + '      <div style="margin-top:6px; font-size:15px;">' + statusBadgeHtml + '</div>'
      + '    </div>'
      + '  </div>'
      + '  <div class="profile-actions">'
      + '    <button class="btn">å°é– / åˆªé™¤</button>'
      +      actionHtml
      + '  </div>'
      + '</div>'
      + '<div class="section">'
      + '  <div class="profile-cta-row">'
      + '    <button class="big-cta-btn primary" onclick="sendGiftAnimationFromHeader(this)">ğŸ é€ç¦®ç‰©</button>'
      + '  </div>'
      + '</div>'
      + '<div class="section">'
      + '  <div class="section-title">ç›¸ç°¿ï¼ˆæ¯å¼µéƒ½æœ‰é€ç¦®å…¥å£ï¼‰</div>'
      + '  <div class="album-grid">'
      +       albumHtml
      + '  </div>'
      + '  <div class="album-note">'
      + '    ç›¸ç°¿åƒ…ç¤ºæ„ï¼Œæ­£å¼ç‰ˆå¯ä»¥ä¸Šå‚³è‡ªå·±çš„ç…§ç‰‡ã€è¨­å®šå¯è¦‹ç¯„åœèˆ‡è§£é–æ–¹å¼ã€‚<br/>'
      + '    Demoï¼šå‰å…©å¼µç‚ºå…è²»é è¦½ï¼Œå¾Œå››å¼µéœ€è§€çœ‹å»£å‘Šæ‰å¯åœ¨ 30 åˆ†é˜å…§è§£é–ã€‚'
      + '  </div>'
      + '</div>'
      + '<div class="section">'
      + '  <div class="section-title">åŸºæœ¬è³‡æ–™</div>'
      + '  <table class="info-table">'
      + '    <tr><td class="info-key">æš±ç¨±</td><td class="info-value">' + p.name + '</td></tr>'
      + '    <tr><td class="info-key">æ€§åˆ¥</td><td class="info-value">æœªè¨­å®š</td></tr>'
      + '    <tr><td class="info-key">å¹´é½¡å±¤</td><td class="info-value">' + p.ageText + '</td></tr>'
      + '    <tr><td class="info-key">åœ‹å®¶</td><td class="info-value">å°ç£</td></tr>'
      + '    <tr><td class="info-key">åœ°å€</td><td class="info-value">æœªè¨­å®š</td></tr>'
      + '    <tr><td class="info-key">è‡ªæˆ‘ä»‹ç´¹</td><td class="info-value">' + p.desc + '</td></tr>'
      + '  </table>'
      + '</div>'
      + '<div class="section">'
      + '  <div class="section-title">è‡ªä»‹æ—¥è¨˜ï¼ˆç¤ºæ„ï¼‰</div>'
      + '  <div class="diary-list">'
      + '    <div class="diary-item">'
      + '      <div class="diary-date">2025-11-25</div>'
      + '      <div>é€™è£¡ä¹‹å¾Œå¯ä»¥é¡¯ç¤ºå°æ–¹çš„ 5 ç¯‡ä»£è¡¨æ—¥è¨˜ï¼Œè®“äººæ›´äº†è§£ä»–ã€‚</div>'
      + '    </div>'
      + '  </div>'
      + '</div>';

    showPage("profileDetail");
    topTitleEl.textContent = p.name;
    topRightSlot.innerHTML = "";
  }

  // ==== å¥½å‹åˆ—è¡¨ ====
  function renderStatusInline(status, text) {
    let cls = "status-badge status-inline";
    if (status === "busy") cls += " status-busy";
    if (status === "away" || status === "offline") cls += " status-away";
    if (status === "eating") cls += " status-eating";
    if (status === "shower") cls += " status-shower";
    return '<span class="' + cls + '"><span class="status-dot"></span><span>' + text + "</span></span>";
  }

  function renderFriendsList(type) {
    friendsListEl.innerHTML = "";
    currentFriendTab = type;
    const noteText = (friendNoteInput && friendNoteInput.value.trim()) || "ï¼ˆå°šæœªè¨­å®šï¼‰";

    let ids = [];
    if (type === "friends") ids = friendIds.slice();
    else if (type === "sent") ids = sentRequestIds.slice();
    else if (type === "received") ids = receivedRequestIds.slice();

    if (ids.length === 0) {
      const li = document.createElement("li");
      li.className = "list-item";
      li.innerHTML = ''
        + '<div class="item-main">'
        + '  <div class="item-row2" style="color:#9ca3af;">ç›®å‰æ­¤åˆ†é¡æ²’æœ‰è³‡æ–™ï¼ˆDemoï¼‰</div>'
        + '</div>';
      friendsListEl.appendChild(li);
      return;
    }

    ids.forEach(id => {
      const p = getPersonById(id);
      if (!p) return;

      const li = document.createElement("li");
      li.className = "list-item";

      const statusHtml = renderStatusInline(p.status, p.statusText || "å·²ä¸Šç·š");

      let row3Html = "";
      let extraActionsHtml = "";

      if (type === "friends") {
        row3Html = '<div class="item-row3"><span class="label">å¥½å‹é™å®šï¼š</span>' + noteText + '</div>';
      } else if (type === "sent") {
        row3Html = '<div class="item-row3"><span class="label">ç‹€æ…‹ï¼š</span>å·²é€å‡ºå¥½å‹ç”³è«‹ï¼Œç­‰å¾…å°æ–¹å›æ‡‰</div>';
        extraActionsHtml = ''
          + '<div class="item-row3">'
          + '  <button class="btn btn-sm" onclick="hmCancelFriendRequest(' + id + ')">å–æ¶ˆç”³è«‹</button>'
          + '</div>';
      } else if (type === "received") {
        row3Html = '<div class="item-row3"><span class="label">ç‹€æ…‹ï¼š</span>å°ä½ ç™¼é€äº†å¥½å‹ç”³è«‹</div>';
        extraActionsHtml = ''
          + '<div class="item-row3">'
          + '  <button class="btn btn-primary btn-sm" onclick="hmAcceptFriend(' + id + ')">åŒæ„</button>'
          + '  <button class="btn btn-sm" onclick="hmRejectFriend(' + id + ')">æ‹’çµ•</button>'
          + '</div>';
      }

      li.innerHTML = ''
        + '<div class="avatar">'
        + '  <img src="' + p.avatar + '" alt="' + p.name + '" />'
        + '</div>'
        + '<div class="item-main">'
        + '  <div class="item-row1">'
        + '    <div class="item-row1-left">'
        + '      <span class="item-name">' + p.name + '</span>'
        + '      <span class="item-mood">ğŸ˜Š</span>'
        + '    </div>'
        +      statusHtml
        + '  </div>'
        + '  <div class="item-row2">' + (p.desc || (p.ageText || "")) + '</div>'
        +      row3Html
        +      extraActionsHtml
        + '</div>';

      const avatarEl = li.querySelector(".avatar");
      const mainEl = li.querySelector(".item-main");

      if (avatarEl) {
        avatarEl.addEventListener("click", (e) => {
          e.stopPropagation();
          openProfileDetail(id);
        });
      }

      if (mainEl && type === "friends") {
        mainEl.addEventListener("click", (e) => {
          e.stopPropagation();
          openChatWith(id);
        });
      }

      friendsListEl.appendChild(li);
    });
  }

  // ==== æ’è¡Œæ¦œå‡è³‡æ–™ ====
  const rankPyramidEl = document.getElementById("rankPyramid");
  const rankListEl = document.getElementById("rankList");

  const rankData = {
    pop: [
      { pos: 1, title: "King", name: "Sunny", city: "å°åŒ—", age: "20+", score: 9820, avatar: "https://picsum.photos/200/200?random=201" },
      { pos: 2, title: "Princess", name: "Amy", city: "é«˜é›„", age: "25+", score: 9130, avatar: "https://picsum.photos/200/200?random=202" },
      { pos: 3, title: "Prince", name: "Max", city: "æ–°åŒ—", age: "22+", score: 8990, avatar: "https://picsum.photos/200/200?random=203" },
      { pos: 4, title: "Duke", name: "Lynn", city: "å°ä¸­", age: "23+", score: 8500, avatar: "https://picsum.photos/200/200?random=204" },
      { pos: 5, title: "Duke", name: "Zero", city: "æ¡ƒåœ’", age: "20+", score: 8420, avatar: "https://picsum.photos/200/200?random=205" },
      { pos: 6, title: "Duchess", name: "Mika", city: "å°å—", age: "27+", score: 8300, avatar: "https://picsum.photos/200/200?random=206" },
      { pos: 7, title: "Marquis", name: "é˜¿å“²", city: "æ–°ç«¹", age: "28+", score: 7900, avatar: "https://picsum.photos/200/200?random=207" },
      { pos: 8, title: "Baron", name: "å°è‘‰", city: "åŸºéš†", age: "24+", score: 7600, avatar: "https://picsum.photos/200/200?random=208" }
    ],
    receive: [
      { pos: 1, title: "Queen", name: "Rin", city: "å°åŒ—", age: "21+", score: 10010, avatar: "https://picsum.photos/200/200?random=211" },
      { pos: 2, title: "Princess", name: "Nana", city: "æ–°åŒ—", age: "26+", score: 9200, avatar: "https://picsum.photos/200/200?random=212" },
      { pos: 3, title: "Duke", name: "Ken", city: "é«˜é›„", age: "29+", score: 8800, avatar: "https://picsum.photos/200/200?random=213" },
      { pos: 4, title: "Duchess", name: "Sasa", city: "æ¡ƒåœ’", age: "23+", score: 8400, avatar: "https://picsum.photos/200/200?random=214" }
    ],
    send: [
      { pos: 1, title: "King", name: "Leo", city: "å°ä¸­", age: "30+", score: 11000, avatar: "https://picsum.photos/200/200?random=221" },
      { pos: 2, title: "Prince", name: "Sean", city: "å°åŒ—", age: "24+", score: 9600, avatar: "https://picsum.photos/200/200?random=222" },
      { pos: 3, title: "Duke", name: "Kai", city: "æ–°åŒ—", age: "27+", score: 9000, avatar: "https://picsum.photos/200/200?random=223" },
      { pos: 4, title: "Baron", name: "ç±³ç³•", city: "èŠ±è“®", age: "32+", score: 8200, avatar: "https://picsum.photos/200/200?random=224" }
    ]
  };

  function renderRank(type) {
    const data = rankData[type] || [];
    if (data.length === 0) {
      rankPyramidEl.innerHTML = "<div style='font-size:14px; color:#9ca3af; text-align:center;'>æš«ç„¡æ’åè³‡æ–™</div>";
      rankListEl.innerHTML = "";
      return;
    }

    const king = data[0];
    const second = data[1];
    const third = data[2];
    const fourth = data[3];
    const fifth = data[4];
    const sixth = data[5];
    const rest = data.slice(6);

    let pyramidHtml = ''
      + '<div class="rank-row">'
      + '  <div class="rank-card">'
      + '    <div class="rank-badge">'
      + '      <span class="icon">ğŸ‘‘</span>'
      + '      <span>' + king.title + '</span>'
      + '    </div>'
      + '    <div class="rank-avatar-wrap king">'
      + '      <div class="rank-avatar">'
      + '        <img src="' + king.avatar + '" alt="' + king.name + '" />'
      + '      </div>'
      + '    </div>'
      + '    <div class="rank-name">' + king.name + '</div>'
      + '    <div class="rank-sub">' + king.city + ' Â· ' + king.age + '</div>'
      + '  </div>'
      + '</div>';

    pyramidHtml += '<div class="rank-row">';
    if (second) {
      pyramidHtml += ''
        + '<div class="rank-card">'
        + '  <div class="rank-avatar-wrap">'
        + '    <div class="rank-avatar medium">'
        + '      <img src="' + second.avatar + '" alt="' + second.name + '" />'
        + '    </div>'
        + '  </div>'
        + '  <div class="rank-name">' + second.name + '</div>'
        + '  <div class="rank-sub">' + second.title + ' Â· ' + second.city + '</div>'
        + '</div>';
    }
    if (third) {
      pyramidHtml += ''
        + '<div class="rank-card">'
        + '  <div class="rank-avatar-wrap">'
        + '    <div class="rank-avatar medium">'
        + '      <img src="' + third.avatar + '" alt="' + third.name + '" />'
        + '    </div>'
        + '  </div>'
        + '  <div class="rank-name">' + third.name + '</div>'
        + '  <div class="rank-sub">' + third.title + ' Â· ' + third.city + '</div>'
        + '</div>';
    }
    pyramidHtml += '</div>';

    pyramidHtml += '<div class="rank-row">';
    [fourth, fifth, sixth].forEach(item => {
      if (!item) return;
      pyramidHtml += ''
        + '<div class="rank-card">'
        + '  <div class="rank-avatar-wrap">'
        + '    <div class="rank-avatar small">'
        + '      <img src="' + item.avatar + '" alt="' + item.name + '" />'
        + '    </div>'
        + '  </div>'
        + '  <div class="rank-name">' + item.name + '</div>'
        + '  <div class="rank-sub">' + item.title + ' Â· ' + item.city + '</div>'
        + '</div>';
    });
    pyramidHtml += '</div>';

    rankPyramidEl.innerHTML = pyramidHtml;

    rankListEl.innerHTML = "";
    rest.forEach(item => {
      const li = document.createElement("div");
      li.className = "rank-list-item";
      li.innerHTML = ''
        + '<div class="rank-pos">' + item.pos + '</div>'
        + '<div class="rank-list-avatar">'
        + '  <img src="' + item.avatar + '" alt="' + item.name + '" />'
        + '</div>'
        + '<div class="rank-list-main">'
        + '  <div class="rank-list-name">' + item.name + ' Â· ' + item.title + '</div>'
        + '  <div class="rank-list-sub">' + item.city + ' Â· ' + item.age + '</div>'
        + '</div>'
        + '<div class="rank-score">' + item.score + ' åˆ†</div>';
      rankListEl.appendChild(li);
    });
  }

  const pages = {
    people: document.getElementById("page-people"),
    profileDetail: document.getElementById("page-profileDetail"),
    friends: document.getElementById("page-friends"),
    rank: document.getElementById("page-rank"),
    chat: document.getElementById("page-chat"),
    me: document.getElementById("page-me")
  };

  function showPage(pageName) {
    Object.keys(pages).forEach(k => {
      pages[k].classList.toggle("active", k === pageName);
    });
  }

  function renderTopRightForPage(pageName) {
    topRightSlot.innerHTML = "";
    if (pageName === "me") {
      const btn = document.createElement("button");
      btn.className = "icon-button";
      btn.innerHTML = ''
        + '<svg class="icon-gear" viewBox="0 0 20 20" fill="none">'
        + '<path d="M9.999 12.5a2.5 2.5 0 1 0 0-5.001 2.5 2.5 0 0 0 0 5z" stroke="#4B5563" stroke-width="1.3" />'
        + '<path d="M15.167 8.583a5.53 5.53 0 0 0-.11-.44l1.16-1.174a.55.55 0 0 0 .09-.648l-1.1-1.905a.55.55 0 0 0-.628-.26l-1.62.49a5.43 5.43 0 0 0-.77-.44l-.25-1.68A.55.55 0 0 0 11.41 2h-2.2a.55.55 0 0 0-.546.46l-.25 1.68a5.42 5.42 0 0 0-.77.44l-1.62-.49a.55.55 0 0 0-.629.26L4.295 5.3a.55.55 0 0 0 .09.649l1.16 1.173c-.05.144-.087.291-.11.441L4.5 8.999a.55.55 0 0 0-.5.546v2.91c0 .29.219.53.5.546l1.935.12c.034.145.077.288.129.429l-1.178 1.24a.55.55 0 0 0-.067.659l1.2 1.856a.55.55 0 0 0 .622.239l1.74-.56c.13.073.263.14.4.2l.27 1.78a.55.55 0 0 0 .545.46h2.2a.55.55 0 0 0 .545-.46l.27-1.78c.137-.06.27-.127.4-.2l1.74.56a.55.55 0 0 0 .622-.239l1.2-1.857a.55.55 0 0 0-.068-.658l-1.177-1.24c.052-.141.095-.284.129-.429l1.935-.12a.55.55 0 0 0 .5-.547v-2.91a.55.55 0 0 0-.5-.546L15.167 8.583z" stroke="#4B5563" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/>'
        + '</svg>';
      btn.addEventListener("click", () => {
        alert("è¨­å®šé¢æ¿ä¹‹å¾Œæœƒæ¥ä¸ŠçœŸæ­£çš„åŠŸèƒ½ï¼ˆç›®å‰ç‚ºç¤ºæ„ï¼‰ã€‚");
      });
      topRightSlot.appendChild(btn);
    }
  }

  function switchPage(pageName) {
    if (pageName === "people") topTitleEl.textContent = "äººå€‘ Â· å¿ƒé‡ XinYou";
    if (pageName === "friends") topTitleEl.textContent = "å¥½å‹";
    if (pageName === "rank") topTitleEl.textContent = "æ’è¡Œæ¦œ";
    if (pageName === "chat") topTitleEl.textContent = "èŠå¤©";
    if (pageName === "me") topTitleEl.textContent = "æˆ‘çš„æª”æ¡ˆ";

    if (pageName !== "profileDetail") {
      showPage(pageName);
    }
    renderTopRightForPage(pageName);
  }

  // é–‹å•ŸèŠå¤©ï¼šåªæœ‰å¥½å‹å¯ä»¥
  function openChatWith(id) {
    const relation = hmGetRelation(id);
    if (relation !== "friend") {
      alert("åªæœ‰æˆç‚ºå¥½å‹å¾Œæ‰èƒ½ä½¿ç”¨ 1 å° 1 èŠå¤©ã€‚ï¼ˆDemoï¼‰");
      return;
    }
    const p = getPersonById(id);
    switchPage("chat");
    if (p) {
      topTitleEl.textContent = "èˆ‡ " + p.name + " èŠå¤©";
    } else {
      topTitleEl.textContent = "èŠå¤©";
    }
  }

  window.openChatWith = openChatWith;
  window.hmAddFriend = hmAddFriend;
  window.hmAcceptFriend = hmAcceptFriend;
  window.hmRejectFriend = hmRejectFriend;
  window.hmCancelFriendRequest = hmCancelFriendRequest;

  document.querySelectorAll(".nav-item").forEach(item => {
    item.addEventListener("click", () => {
      const page = item.getAttribute("data-page");
      document.querySelectorAll(".nav-item").forEach(i => i.classList.remove("active"));
      item.classList.add("active");
      switchPage(page);

      if (page === "rank") renderRank(currentRankTab);
    });
  });

  document.querySelectorAll("[data-friendtab]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll("[data-friendtab]").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      const type = btn.getAttribute("data-friendtab");
      currentFriendTab = type;
      renderFriendsList(type);
    });
  });

  let currentRankTab = "pop";
  document.querySelectorAll("[data-ranktab]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll("[data-ranktab]").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      currentRankTab = btn.getAttribute("data-ranktab");
      renderRank(currentRankTab);
    });
  });

  // toggle
  document.querySelectorAll(".toggle").forEach(t => {
    t.addEventListener("click", () => {
      t.classList.toggle("on");
    });
  });

  // èŠå¤©é€å‡º & + åŠŸèƒ½
  const chatMessagesEl = document.getElementById("chatMessages");
  const chatInputEl = document.getElementById("chatInput");
  const chatSendBtn = document.getElementById("chatSendBtn");
  const stickerBar = document.getElementById("stickerBar");
  const chatMoreMenu = document.getElementById("chatMoreMenu");
  const chatPlusBtn = document.getElementById("chatPlusBtn");
  const chatWrapper = document.getElementById("chatWrapper");
  const chatPhotoBtn = document.getElementById("chatPhotoBtn");
  const chatGifBtn = document.getElementById("chatGifBtn");
  const chatPhotoInput = document.getElementById("chatPhotoInput");
  const chatGifInput = document.getElementById("chatGifInput");

  function sendChat() {
    const text = chatInputEl.value.trim();
    if (!text) return;
    const row = document.createElement("div");
    row.className = "bubble-row me";
    row.innerHTML = '<div class="bubble me">' + text + "</div>";
    chatMessagesEl.appendChild(row);
    chatInputEl.value = "";
    chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
  }
  chatSendBtn.addEventListener("click", sendChat);
  chatInputEl.addEventListener("keydown", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendChat();
    }
  });

  chatPlusBtn.addEventListener("click", () => {
    chatMoreMenu.classList.toggle("show");
  });

  // è²¼åœ– / ç…§ç‰‡ / GIF
  chatMoreMenu.querySelectorAll(".chat-more-btn").forEach(btn => {
    const type = btn.getAttribute("data-type");
    if (type === "sticker") {
      btn.addEventListener("click", () => {
        stickerBar.classList.toggle("show");
      });
    }
  });

  function sendImageMessage(dataUrl, label) {
    const row = document.createElement("div");
    row.className = "bubble-row me";
    row.innerHTML = ''
      + '<div class="bubble me">'
      + '  <img src="' + dataUrl + '" alt="' + label + '" class="chat-image" />'
      + '</div>';
    chatMessagesEl.appendChild(row);
    chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight;
  }

  chatPhotoBtn.addEventListener("click", () => {
    chatPhotoInput.click();
  });

  chatGifBtn.addEventListener("click", () => {
    chatGifInput.click();
  });

  chatPhotoInput.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
      const dataUrl = ev.target.result;
      if (!dataUrl) return;
      sendImageMessage(dataUrl, "photo");
    };
    reader.readAsDataURL(file);
    e.target.value = "";
  });

  chatGifInput.addEventListener("change", (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
      const dataUrl = ev.target.result;
      if (!dataUrl) return;
      sendImageMessage(dataUrl, "gif");
    };
    reader.readAsDataURL(file);
    e.target.value = "";
  });

  stickerBar.querySelectorAll(".sticker-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const emo = btn.textContent;
      chatInputEl.value += emo;
      chatInputEl.focus();
    });
  });

  // èŠå¤©èƒŒæ™¯ä¸»é¡Œ
  document.querySelectorAll(".chat-theme-pill").forEach(pill => {
    pill.addEventListener("click", () => {
      document.querySelectorAll(".chat-theme-pill").forEach(p => p.classList.remove("active"));
      pill.classList.add("active");
      const theme = pill.getAttribute("data-theme");
      chatWrapper.className = "chat-wrapper chat-theme-" + theme;
    });
  });

  // æˆ‘çš„ç‹€æ…‹
  const statusSelect = document.getElementById("statusSelect");
  const myStatusBadge = document.getElementById("myStatusBadge");
  const myStatusText = document.getElementById("myStatusText");
  const myProfileSub = document.getElementById("myProfileSub");
  function updateMyStatus() {
    const val = statusSelect.value;
    let text = "å·²ä¸Šç·š";
    let cls = "status-badge";

    if (val === "online") text = "å·²ä¸Šç·š";
    if (val === "busy") { text = "å¿™ç¢Œä¸­â€¦"; cls += " status-busy"; }
    if (val === "eating") { text = "ç”¨é¤å»â€¦"; cls += " status-eating"; }
    if (val === "shower") { text = "æ´—æ¾¡ä¸­â€¦"; cls += " status-shower"; }
    if (val === "away") { text = "æš«é›¢ä¸­â€¦"; cls += " status-away"; }
    if (val === "offline") { text = "é›¢ç·šä¸­"; cls += " status-away"; }
    if (val === "chatty") text = "æƒ³èŠå¤©";

    myStatusBadge.className = cls;
    myStatusText.textContent = text;
    myProfileSub.textContent = "å°ç£ Â· 30 æ­²å·¦å³ Â· " + text;
  }
  statusSelect.addEventListener("change", updateMyStatus);

  // å¥½å‹é™å®šå°èªåŒæ­¥é è¦½
  const friendNoteInput = document.getElementById("friendNoteInput");
  const friendNotePreview = document.getElementById("friendNotePreview");
  function updateFriendNotePreview() {
    const t = friendNoteInput.value.trim() || "ï¼ˆå°šæœªè¨­å®šï¼‰";
    friendNotePreview.innerHTML = '<span class="label">å¥½å‹é™å®šï¼š</span>' + t;
  }
  friendNoteInput.addEventListener("input", updateFriendNotePreview);

  // Viewer & é€ç¦®å‹•ç•«
  function openPhotoViewer(src) {
    const viewer = document.getElementById("photoViewer");
    const img = viewer.querySelector("img");
    img.src = src;
    viewer.classList.add("show");
  }
  function closeViewer() {
    document.getElementById("photoViewer").classList.remove("show");
  }
  window.openPhotoViewer = openPhotoViewer;
  window.closeViewer = closeViewer;

  // ä¾ã€Œä½¿ç”¨è€… id + ç¬¬å¹¾å¼µã€å–å¾—å°æ–¹çš„ç›¸ç°¿ç…§ç‰‡
  function hmGetPersonAlbumPhotoSrc(personId, idx) {
    const p = getPersonById(personId);
    if (p && Array.isArray(p.album) && p.album[idx]) {
      return p.album[idx];
    }
    if (albumPhotos && albumPhotos[idx]) {
      return albumPhotos[idx];
    }
    return "https://picsum.photos/400/400?random=" + (901 + idx);
  }

  function spawnHeart(x, y) {
    const h = document.createElement("div");
    h.className = "gift-heart";
    h.textContent = "ğŸ’—";
    h.style.left = x + "px";
    h.style.top = y + "px";
    document.body.appendChild(h);
    setTimeout(() => h.remove(), 1000);
  }
  function sendGiftAnimation(el) {
    const rect = el.getBoundingClientRect();
    spawnHeart(rect.left + rect.width / 2, rect.top);
    alert("é€™é‚Šä¹‹å¾Œæœƒæ‰“é–‹é€ç¦®ç‰©é¢æ¿ã€‚");
  }
  function sendGiftAnimationFromHeader(btn) {
    const rect = btn.getBoundingClientRect();
    spawnHeart(rect.left + rect.width / 2, rect.top);
    alert("é€™é‚Šä¹‹å¾Œæœƒæ‰“é–‹é€ç¦®ç‰©é¢æ¿ã€‚");
  }
  function setAsAvatar(idx) {
    let newAvatar;
    if (currentProfileId != null) {
      newAvatar = hmGetPersonAlbumPhotoSrc(currentProfileId, idx);
    } else {
      newAvatar = hmGetAlbumPhotoSrc(idx);
    }
    const avatarImg = document.querySelector(".profile-avatar img");
    if (avatarImg) avatarImg.src = newAvatar;
    alert("å·²æŠŠé€™å¼µç…§ç‰‡è¨­ç‚ºé ­è²¼ï¼ï¼ˆDemoï¼‰");
  }
  window.sendGiftAnimation = sendGiftAnimation;
  window.sendGiftAnimationFromHeader = sendGiftAnimationFromHeader;
  window.setAsAvatar = setAsAvatar;

  // ================== åŸºæœ¬è³‡æ–™ + ç¶å®šå¸³è™Ÿ + æˆ‘çš„è³‡æ–™å¡ç‰‡ ==================
  function hmHasCompletedProfile() {
    try {
      return localStorage.getItem("hmProfileCompleted") === "true";
    } catch (e) {
      return false;
    }
  }

  function hmSaveProfileData(data) {
    try {
      localStorage.setItem("hmProfileData", JSON.stringify(data));
      localStorage.setItem("hmProfileCompleted", "true");
    } catch (e) {
      console.warn("ç„¡æ³•å„²å­˜ä½¿ç”¨è€…è³‡æ–™åˆ° localStorageï¼š", e);
    }
  }

  function hmSetAuthProvider(provider) {
    try {
      localStorage.setItem("hmAuthProvider", provider);
    } catch (e) {
      console.warn("ç„¡æ³•å„²å­˜ç¶å®šç³»çµ±ï¼š", e);
    }
  }

  function hmGetAuthProvider() {
    try {
      return localStorage.getItem("hmAuthProvider") || "";
    } catch (e) {
      return "";
    }
  }

  function hmBuildSocialUrl(platform, value) {
    if (!value) return null;
    const v = value.trim();
    if (!v) return null;
    if (v.startsWith("http://") || v.startsWith("https://")) {
      return v;
    }
    switch (platform) {
      case "threads":
        return "https://www.threads.net/@" + v.replace(/^@/, "");
      case "x":
        return "https://x.com/" + v.replace(/^@/, "");
      case "instagram":
        return "https://www.instagram.com/" + v.replace(/^@/, "");
      case "facebook":
        return "https://www.facebook.com/" + v;
      case "other":
      default:
        return null;
    }
  }

  function hmInitProfileCard() {
    const dataStr = localStorage.getItem("hmProfileData");
    const nameEl = document.getElementById("hm-profile-name");
    const metaEl = document.getElementById("hm-profile-meta");
    const regionEl = document.getElementById("hm-profile-region");
    const avatarTextEl = document.getElementById("hm-profile-avatar-text");
    const socialListEl = document.getElementById("hm-profile-social-list");
    const bindEl = document.getElementById("hm-profile-bind");

    if (!nameEl || !metaEl || !regionEl || !avatarTextEl || !socialListEl) return;

    let profile = null;
    if (dataStr) {
      try {
        profile = JSON.parse(dataStr);
      } catch (e) {
        console.warn("è§£æ hmProfileData å¤±æ•—ï¼š", e);
      }
    }
    const name = profile && profile.name ? profile.name : "æœªè¨­å®šå§“å";
    const height = profile && profile.height ? profile.height : "";
    const weight = profile && profile.weight ? profile.weight : "";
    const region = profile && profile.region ? profile.region : "æœªå¡«å¯«";

    nameEl.textContent = name;
    regionEl.textContent = "å±…ä½å€åŸŸï¼š" + region;

    if (height || weight) {
      const hText = height ? height + "cm" : "èº«é«˜æœªå¡«å¯«";
      const wText = weight ? weight + "kg" : "é«”é‡æœªå¡«å¯«";
      metaEl.textContent = hText + " ï¼ " + wText;
    } else {
      metaEl.textContent = "èº«é«˜ / é«”é‡ æœªå¡«å¯«";
    }

    let avatarText = "Me";
    if (name && typeof name === "string") {
      const trimmed = name.trim();
      if (trimmed.length === 1) avatarText = trimmed;
      else if (trimmed.length >= 2) avatarText = trimmed.slice(0, 2);
    }
    avatarTextEl.textContent = avatarText;

    const provider = hmGetAuthProvider();
    if (bindEl) {
      if (!provider) {
        bindEl.textContent = "å°šæœªç¶å®šå¸³è™Ÿ";
      } else if (provider === "google") {
        bindEl.textContent = "å·²ç¶å®šï¼šGoogle å¸³è™Ÿï¼ˆç¤ºæ„ï¼‰";
      } else if (provider === "facebook") {
        bindEl.textContent = "å·²ç¶å®šï¼šFacebook å¸³è™Ÿï¼ˆç¤ºæ„ï¼‰";
      } else if (provider === "apple") {
        bindEl.textContent = "å·²ç¶å®šï¼šApple å¸³è™Ÿï¼ˆç¤ºæ„ï¼‰";
      } else {
        bindEl.textContent = "å·²ç¶å®šï¼šå…¶ä»–ç³»çµ±å¸³è™Ÿï¼ˆç¤ºæ„ï¼‰";
      }
    }

    const socials = (profile && profile.socials) || {};
    const items = [];
    const config = [
      { key: "threads", label: "Threads", short: "Th", className: "hm-social-threads" },
      { key: "x", label: "X", short: "X", className: "hm-social-x" },
      { key: "instagram", label: "IG", short: "IG", className: "hm-social-instagram" },
      { key: "facebook", label: "FB", short: "FB", className: "hm-social-facebook" },
      { key: "other", label: "å…¶ä»–", short: "?", className: "hm-social-other" }
    ];

    socialListEl.innerHTML = "";
    config.forEach((c) => {
      const rawValue = socials[c.key];
      if (!rawValue || !rawValue.trim) return;
      if (!rawValue.trim()) return;
      const url = hmBuildSocialUrl(c.key, rawValue);
      items.push({
        key: c.key,
        label: c.label,
        short: c.short,
        className: c.className,
        raw: rawValue.trim(),
        url
      });
    });

    if (items.length === 0) {
      const span = document.createElement("span");
      span.className = "hm-profile-social-empty";
      span.textContent = "ç›®å‰å°šæœªä¸²è¯ä»»ä½•ç¤¾ç¾¤å¸³è™Ÿ";
      socialListEl.appendChild(span);
    } else {
      items.forEach((item) => {
        let el;
        if (item.url) {
          el = document.createElement("a");
          el.href = item.url;
          el.target = "_blank";
          el.rel = "noopener noreferrer";
        } else {
          el = document.createElement("div");
        }

        el.className = "hm-social-chip " + item.className;

        const icon = document.createElement("span");
        icon.className = "hm-social-icon";
        icon.textContent = item.short;

        const text = document.createElement("span");
        const displayRaw = item.raw.length > 14 ? item.raw.slice(0, 13) + "..." : item.raw;
        text.textContent = item.label + "ï½œ" + displayRaw;

        el.appendChild(icon);
        el.appendChild(text);
        socialListEl.appendChild(el);
      });
    }
  }

  // ================== VIP & æˆ‘çš„ 6 å¼µç…§ç‰‡ï¼ˆæœ¬æ©Ÿç¤ºæ„ï¼‰ ==================
  const MY_ALBUM_SLOTS = 6;
  let myAlbumPhotosCache = null;

  function hmGetVipLevel() {
    try {
      const raw = localStorage.getItem("hmVipLevel");
      const n = parseInt(raw || "0", 10);
      if (isNaN(n) || n < 0) return 0;
      if (n > 5) return 5;
      return n;
    } catch (e) {
      return 0;
    }
  }

  function hmSetVipLevel(level) {
    const lvl = Math.min(Math.max(level, 0), 5);
    try {
      localStorage.setItem("hmVipLevel", String(lvl));
    } catch (e) {}
    hmUpdateVipUI();
    renderMyAlbum();
    if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
      openProfileDetail(currentProfileId);
    }
  }

  function hmUpdateVipUI() {
    const lvl = hmGetVipLevel();
    const badge = document.getElementById("myVipBadge");
    const textEl = document.getElementById("vipLevelText");

    if (badge) {
      if (lvl <= 0) {
        badge.style.display = "none";
        badge.textContent = "";
      } else {
        badge.style.display = "inline-flex";
        badge.textContent = "VIP" + lvl;
      }
    }

    if (textEl) {
      if (lvl <= 0) {
        textEl.textContent = "ç›®å‰ VIP ç­‰ç´šï¼šç„¡ï¼ˆDemoï¼‰";
      } else {
        textEl.textContent = "ç›®å‰ VIP ç­‰ç´šï¼šVIP" + lvl + "ï¼ˆDemoï¼‰";
      }
    }
  }

  function hmLoadAlbumPhotos() {
    if (myAlbumPhotosCache) return myAlbumPhotosCache;
    try {
      const raw = localStorage.getItem("hmMyAlbumPhotos");
      if (raw) {
        const parsed = JSON.parse(raw);
        if (Array.isArray(parsed) && parsed.length === MY_ALBUM_SLOTS) {
          myAlbumPhotosCache = parsed;
          return parsed;
        }
      }
    } catch (e) {
      console.warn("è®€å–ç›¸ç°¿ç…§ç‰‡å¤±æ•—ï¼š", e);
    }
    myAlbumPhotosCache = new Array(MY_ALBUM_SLOTS).fill(null);
    return myAlbumPhotosCache;
  }

  function hmSaveAlbumPhotos() {
    try {
      localStorage.setItem("hmMyAlbumPhotos", JSON.stringify(myAlbumPhotosCache || []));
    } catch (e) {
      console.warn("å„²å­˜ç›¸ç°¿ç…§ç‰‡å¤±æ•—ï¼š", e);
    }
  }

  function hmAlbumGetUnlockUntil() {
    try {
      const raw = localStorage.getItem("hmAlbumUnlockUntil");
      const t = parseInt(raw || "0", 10);
      return isNaN(t) ? 0 : t;
    } catch (e) {
      return 0;
    }
  }

  function hmAlbumIsUnlocked() {
    if (hmGetVipLevel() > 0) return true;
    const until = hmAlbumGetUnlockUntil();
    return until > Date.now();
  }

  function hmAlbumUnlockFor30Minutes() {
    const unlockUntil = Date.now() + 30 * 60 * 1000;
    try {
      localStorage.setItem("hmAlbumUnlockUntil", String(unlockUntil));
    } catch (e) {
      console.warn("å„²å­˜ç›¸ç°¿è§£é–æ™‚é–“å¤±æ•—ï¼š", e);
    }
    alert("Demoï¼šå‡è¨­ä½ çœ‹å®Œä¸€æ®µå»£å‘Šï¼Œæ¥ä¸‹ä¾† 30 åˆ†é˜å…§ 6 å¼µç…§ç‰‡éƒ½æœƒé–‹æ”¾çµ¦é™Œç”Ÿäººèˆ‡å¥½å‹æŸ¥çœ‹ã€‚");
    renderMyAlbum();
    if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
      openProfileDetail(currentProfileId);
    }
  }

  function hmAlbumUnlock() {
    hmAlbumUnlockFor30Minutes();
  }

  function hmGetAlbumPhotoSrc(idx) {
    const photos = hmLoadAlbumPhotos();
    const fallback = albumPhotos;
    const p = photos[idx];
    if (p) return p;
    if (fallback && fallback[idx]) return fallback[idx];
    return "https://picsum.photos/400/400?random=" + (901 + idx);
  }

  function renderMyAlbum() {
    const grid = document.getElementById("myAlbumGrid");
    if (!grid) return;
    const photos = hmLoadAlbumPhotos();
    const vip = hmGetVipLevel();
    const unlocked = hmAlbumIsUnlocked();

    grid.innerHTML = "";

    for (let i = 0; i < MY_ALBUM_SLOTS; i++) {
      const isFree = i < 2;
      const isLocked = !isFree && vip === 0 && !unlocked;

      const slot = document.createElement("div");
      slot.className = "my-album-item";

      const img = document.createElement("img");
      img.id = "myAlbumImg_" + i;
      const src = hmGetAlbumPhotoSrc(i);
      img.src = src || "";
      if (!photos[i]) {
        img.style.opacity = "0.3";
      }
      slot.appendChild(img);

      const label = document.createElement("div");
      label.className = "my-album-slot-label";
      if (isFree) {
        label.textContent = "ç¬¬ " + (i + 1) + " å¼µ Â· å…è²»é è¦½";
      } else {
        label.textContent = "ç¬¬ " + (i + 1) + " å¼µ Â· éœ€è§£é–";
      }
      slot.appendChild(label);

      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.style.display = "none";
      fileInput.id = "myAlbumInput_" + i;
      slot.appendChild(fileInput);

      const uploadBtn = document.createElement("button");
      uploadBtn.type = "button";
      uploadBtn.className = "my-album-upload-btn";
      uploadBtn.textContent = photos[i] ? "æ›´æ›" : "ä¸Šå‚³";
      uploadBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        fileInput.click();
      });
      slot.appendChild(uploadBtn);

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files && e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function (ev) {
          const result = ev.target.result;
          if (!result) return;
          const arr = hmLoadAlbumPhotos();
          arr[i] = result;
          myAlbumPhotosCache = arr;
          hmSaveAlbumPhotos();
          renderMyAlbum();
          if (pages.profileDetail.classList.contains("active") && currentProfileId != null) {
            openProfileDetail(currentProfileId);
          }
        };
        reader.readAsDataURL(file);
      });

      if (isLocked) {
        const overlay = document.createElement("div");
        overlay.className = "my-album-lock-overlay";
        overlay.innerHTML = ''
          + '<div>ğŸ”’ é–å®šç…§ç‰‡<br>è§€çœ‹ä¸€æ¬¡å»£å‘Šå³å¯åœ¨ 30 åˆ†é˜å…§è§£é– 6 å¼µç…§ç‰‡</div>';
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "my-album-lock-btn";
        btn.textContent = "è§€çœ‹å»£å‘Šæš«æ™‚è§£é–ï¼ˆDemoï¼‰";
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          hmAlbumUnlockFor30Minutes();
        });
        overlay.appendChild(btn);
        slot.appendChild(overlay);
      }

      grid.appendChild(slot);
    }
  }

  function hmShowAlbumAdPrompt() {
    const go = confirm("é€™ 4 å¼µç…§ç‰‡éœ€è§€çœ‹ä¸€æ®µå»£å‘Šæ‰èƒ½åœ¨ 30 åˆ†é˜å…§è§£é–ã€‚\nè¦å‰å¾€å»£å‘Šé ï¼ˆDemoï¼‰å—ï¼Ÿ");
    if (!go) return;
    window.open("https://example.com", "_blank");
    hmAlbumUnlockFor30Minutes();
  }

  function handleStrangerAlbumClick(personId, idx) {
    const vip = hmGetVipLevel();
    if (idx < 2 || vip > 0 || hmAlbumIsUnlocked()) {
      openPhotoViewer(hmGetPersonAlbumPhotoSrc(personId, idx));
    } else {
      hmShowAlbumAdPrompt();
    }
  }
  window.handleStrangerAlbumClick = handleStrangerAlbumClick;
  window.hmGetAlbumPhotoSrc = hmGetAlbumPhotoSrc;
  window.hmGetPersonAlbumPhotoSrc = hmGetPersonAlbumPhotoSrc;

  document.addEventListener("DOMContentLoaded", function () {
    pickRandomBatch();
    renderPeopleGrid();

    // å¥½å‹ tab å…ƒä»¶
    friendTabFriendsEl = document.querySelector('.tab-btn[data-friendtab="friends"]');
    friendTabSentEl = document.querySelector('.tab-btn[data-friendtab="sent"]');
    friendTabReceivedEl = document.querySelector('.tab-btn[data-friendtab="received"]');
    updateFriendTabCounts();

    renderFriendsList("friends");
    updateMyStatus();
    updateFriendNotePreview();
    renderTopRightForPage("people");
    renderRank("pop");

    // åˆå§‹åŒ– VIP & æˆ‘çš„ç…§ç‰‡
    hmUpdateVipUI();
    renderMyAlbum();

    const vipToggleBtn = document.getElementById("vipLevelToggleBtn");
    if (vipToggleBtn) {
      vipToggleBtn.addEventListener("click", () => {
        let lvl = hmGetVipLevel();
        lvl = (lvl + 1) % 6; // 0~5 å¾ªç’°
        hmSetVipLevel(lvl);
      });
    }

    // ç™»å…¥ / åŸºæœ¬è³‡æ–™ Modal
    const loginModal = document.getElementById("hm-login-modal");
    const profileModal = document.getElementById("hm-profile-modal");
    const form = document.getElementById("hm-profile-form");

    if (!hmHasCompletedProfile()) {
      if (loginModal) loginModal.style.display = "flex";
    }

    function handleFakeLogin(provider) {
      hmSetAuthProvider(provider);
      if (loginModal) loginModal.style.display = "none";
      if (!hmHasCompletedProfile() && profileModal) {
        profileModal.style.display = "flex";
      }
      hmInitProfileCard();
    }

    const btnGoogle = document.getElementById("hm-login-google");
    const btnFacebook = document.getElementById("hm-login-facebook");
    const btnApple = document.getElementById("hm-login-apple");

    if (btnGoogle) {
      btnGoogle.addEventListener("click", () => handleFakeLogin("google"));
    }
    if (btnFacebook) {
      btnFacebook.addEventListener("click", () => handleFakeLogin("facebook"));
    }
    if (btnApple) {
      btnApple.addEventListener("click", () => handleFakeLogin("apple"));
    }

    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();

        const name = document.getElementById("hm-name").value.trim();
        const height = document.getElementById("hm-height").value.trim();
        const weight = document.getElementById("hm-weight").value.trim();
        const region = document.getElementById("hm-region").value.trim();
        const threads = document.getElementById("hm-threads").value.trim();
        const x = document.getElementById("hm-x").value.trim();
        const instagram = document.getElementById("hm-instagram").value.trim();
        const facebook = document.getElementById("hm-facebook").value.trim();
        const other = document.getElementById("hm-other").value.trim();
        const agree = document.getElementById("hm-agree").checked;

        if (!name) {
          alert("è«‹å¡«å¯«ç¨±å‘¼ï¼ˆæš±ç¨±ï¼‰");
          return;
        }
        if (!height || !weight) {
          alert("èº«é«˜èˆ‡é«”é‡ç‚ºå¿…å¡«æ¬„ä½");
          return;
        }
        if (!agree) {
          alert("è«‹å‹¾é¸åŒæ„æœå‹™æ¢æ¬¾èˆ‡éš±ç§æ”¿ç­–");
          return;
        }

        const profileData = {
          name,
          height,
          weight,
          region,
          socials: { threads, x, instagram, facebook, other },
          createdAt: new Date().toISOString()
        };

        hmSaveProfileData(profileData);
        if (profileModal) profileModal.style.display = "none";

        hmInitProfileCard();
        console.log("HeartMeet åŸºæœ¬è³‡æ–™å·²å®Œæˆï¼š", profileData);
      });
    }

    hmInitProfileCard();

    const editBtn = document.getElementById("hm-profile-edit-btn");
    if (editBtn && profileModal) {
      editBtn.addEventListener("click", function () {
        profileModal.style.display = "flex";
      });
    }

    const logoutBtn = document.getElementById("hm-logout-btn");
    if (logoutBtn) {
      logoutBtn.addEventListener("click", function () {
        if (!confirm("ç¢ºå®šè¦ç™»å‡ºä¸¦æ¸…é™¤æœ¬æ©Ÿçš„æš«å­˜è³‡æ–™å—ï¼Ÿ\nï¼ˆåŒ…å«åŸºæœ¬è³‡æ–™ã€ç¶å®šç³»çµ±ã€VIP ç­‰ç´šèˆ‡ç›¸ç°¿ç…§ç‰‡ Demo è³‡æ–™ï¼‰")) {
          return;
        }
        try {
          localStorage.removeItem("hmProfileData");
          localStorage.removeItem("hmProfileCompleted");
          localStorage.removeItem("hmAuthProvider");
          localStorage.removeItem("hmVipLevel");
          localStorage.removeItem("hmMyAlbumPhotos");
          localStorage.removeItem("hmAlbumUnlockUntil");
          sessionStorage.removeItem("hmAlbumUnlocked");
        } catch (e) {
          console.warn("ç™»å‡ºæ™‚æ¸…é™¤ localStorage / sessionStorage å¤±æ•—ï¼š", e);
        }
        location.reload();
      });
    }
  });
 </script>
</body>
</html>
